(function(){"use strict";var t={8760:function(t,e,n){n.d(e,{$Z:function(){return i},sy:function(){return r},zH:function(){return o}});const o={rotate:0,opacity:1},i={groupStyle:{},isLock:!1},r=[{icon:"ri-t-box-line",code:"heading",name:"文本",component:"RoyText",propValue:"双击编辑文本",style:{width:100,height:100,rotate:0}},{icon:"ri-table-line",code:"table",name:"表格",component:"RoyTable"},{icon:"ri-layout-2-line",code:"form",name:"表单",component:"RoyForm"},{icon:"iconfont icon-xianduan",code:"line",name:"直线",component:"RoyLine"},{icon:"iconfont icon-xingzhuang-juxing",code:"rectangle",name:"矩形",component:"RoyRect"},{icon:"iconfont icon-xingzhuang-sanjiaoxing",code:"triangle",name:"三角形",component:"RoyTri"},{icon:"iconfont icon-xingzhuang-tuoyuanxing",code:"circle",name:"圆形",component:"RoyCircle"}]},4535:function(t,e,n){var o=n(6369),i=n(3822),r=(n(7658),n(541),function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"roy-toast roy-toast--center",class:`roy-toast__status--${t.status} ${t.isPaused?"roy-toast--hover-tab":""}`,staticStyle:{width:"auto",opacity:"1"},style:t.positionStyle,on:{mouseenter:t.doPause,mouseleave:t.doContinue}},[e("div"),e("div",{staticClass:"roy-toast__main"},[e("i",{class:t.icon}),t.dangerouslyUseHTMLString?e("span",{staticClass:"roy-toast__message",domProps:{innerHTML:t._s(t.message)}}):e("span",{staticClass:"roy-toast__message"},[t._v(t._s(t.message))])]),e("i",{staticClass:"roy-toast__close ri-close-fill",on:{click:t.close}})]):t._e()}),s=[],a={name:"RoyToast",components:{},props:{},data(){return{visible:!1,dangerouslyUseHTMLString:!1,message:"",status:"",duration:5e3,copiedDuration:0,onClose:null,verticalOffset:0,timer:null,pauseTimer:null,isPaused:!1,tikDownInterval:null}},computed:{icon(){switch(this.status){case"info":return"ri-information-line";case"success":return"ri-checkbox-circle-line";case"warning":return"ri-error-warning-line";case"error":return"ri-close-circle-line";default:return""}},positionStyle(){return{top:`${this.verticalOffset}px`,"--duration":`${Math.floor(this.duration/1e3)}s`}}},methods:{close(){this.visible=!1,this.onClose(this),this.$destroy(),this.$el.parentNode.removeChild(this.$el)},clearTimer(){null!==this.timer&&clearTimeout(this.timer),null!==this.pauseTimer&&clearTimeout(this.pauseTimer),null!==this.tikDownInterval&&clearInterval(this.tikDownInterval)},doPause(){this.pauseTimer=setTimeout((()=>{this.doRestart(!0)}),2e3)},doContinue(){null!==this.timer&&clearTimeout(this.pauseTimer),this.doRestart(!1),this.pauseTimer=null},doRestart(t){t?(this.clearTimer(),this.isPaused=!0):this.isPaused&&(this.startTimer(),this.isPaused=!1)},startTimer(){0===this.copiedDuration&&(this.copiedDuration=this.duration),this.duration>0&&(this.timer=setTimeout((()=>{this.close()}),this.copiedDuration),this.tikDownInterval=setInterval((()=>{this.copiedDuration>1e3&&(this.copiedDuration-=1e3)}),1e3))}},created(){},mounted(){this.startTimer()},beforeDestroy(){this.clearTimer(),this.timer=null,this.pauseTimer=null},watch:{}},l=a,c=n(1001),u=(0,c.Z)(l,r,s,!1,null,null,null),d=u.exports;let h,m=o["default"].extend(d),p=[],f=1,g=function(t={}){let e=t.onClose,n="roy_toast_"+f++;t.onClose=function(){g.close(n,e)},h=new m({data:t}),h.id=n,h.$mount(),document.body.appendChild(h.$el);let o=t.offset||0;return p.forEach((t=>{o+=t.$el.offsetHeight})),h.verticalOffset=o,h.visible=!0,p.push(h),h};g.close=function(t,e){let n,o=p.length,i=-1;for(let r=0;r<o;r++)if(t===p[r].id){n=p[r].$el.offsetHeight,i=r,"function"===typeof e&&e(p[r]),p.splice(r,1);break}if(!(o<=1||-1===i||i>p.length-1))for(let r=i;r<o-1;r++){let t=p[r].$el;t.style["top"]=parseInt(t.style["top"],10)-n+"px"}},g.closeAll=function(){for(let t=p.length-1;t>=0;t--)p[t].close()};var y=g;function v(t="",e="warning",n=3e3){y({status:e,message:t,duration:n})}const x=(t,e,n)=>{const i=t[e];o["default"].set(t,e,t[n]),o["default"].set(t,n,i)};var C={mutations:{upComponent(t){const{componentData:e,curComponentIndex:n}=t;n<e.length-1?(x(e,n,n+1),t.curComponentIndex=n+1):v("已经到顶了")},downComponent(t){const{componentData:e,curComponentIndex:n}=t;n>0?(x(e,n,n-1),t.curComponentIndex=n-1):v("已经到底了")},topComponent(t){const{componentData:e,curComponentIndex:n,curComponent:o}=t;n<e.length-1?(e.splice(n,1),e.push(o),t.curComponentIndex=e.length-1):v("已经到顶了")},bottomComponent(t){const{componentData:e,curComponentIndex:n,curComponent:o}=t;n>0?(e.splice(n,1),e.unshift(o),t.curComponentIndex=0):v("已经到底了")}},actions:{}},w=n(691);function b(){return(0,w.x0)()}var M=new o["default"];function S(t,e=[]){if(null===t||"object"!==typeof t)return t;const n=Object.prototype.toString.call(t).slice(8,-1);if("RegExp"===n)return new RegExp(t);if("Date"===n)return new Date(t);if("Error"===n)return new Error(t);const o=e.filter((e=>e.original===t))[0];if(o)return o.copy;const i=Array.isArray(t)?[]:{};return e.push({original:t,copy:i}),Object.keys(t).forEach((n=>{i[n]=S(t[n],e)})),i}function _(t){return document.querySelector(t)}const k=["RoyText","RoyRect","RoyCircle","RoyTran"];function T(t){return!k.includes(t)&&!t.startsWith("SVG")}function $(t){return t*Math.PI/180}function R(t,e,n){return{x:(t.x-e.x)*Math.cos($(n))-(t.y-e.y)*Math.sin($(n))+e.x,y:(t.x-e.x)*Math.sin($(n))+(t.y-e.y)*Math.cos($(n))+e.y}}function D(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}}function E(t){return Math.abs(Math.sin($(t)))}function A(t){return Math.abs(Math.cos($(t)))}function I(t){return(t+360)%360}function P(t){return 100*t+"%"}function N(t,e,n){const o=_(`#component${t.id}`).getBoundingClientRect(),i={x:o.left-e.left+o.width/2,y:o.top-e.top+o.height/2};t.style.rotate=I(t.style.rotate+n.rotate),t.style.width=parseFloat(t.groupStyle.width)/100*n.width,t.style.height=parseFloat(t.groupStyle.height)/100*n.height,t.style.left=i.x-t.style.width/2,t.style.top=i.y-t.style.height/2,t.groupStyle={}}var L=n(8760);function O(t){const e={};return["width","height","top","left","rotate"].forEach((n=>{"rotate"!==n?e[n]=t[n]+"px":e.transform="rotate("+t[n]+"deg)"})),e}const B=["fontSize","width","height","top","left","borderWidth","letterSpacing","borderRadius"];function j(t,e=[]){const n={};return["opacity","width","height","top","left","rotate","fontSize","fontWeight","lineHeight","letterSpacing","textAlign","color"].forEach((o=>{e.includes(o)||("rotate"!==o?""!==t[o]&&(n[o]=t[o],B.includes(o)&&(n[o]+="px")):n.transform=o+"("+t[o]+"deg)")})),n}function Z(t,e=[]){const n={};return Object.keys(t).forEach((o=>{e.includes(o)||("rotate"!==o?""!==t[o]&&(n[o]=t[o],B.includes(o)&&(n[o]+="px")):n.transform=o+"("+t[o]+"deg)")})),n}function H(t){if(t={...t},0!==t.rotate){const e=t.width*A(t.rotate)+t.height*E(t.rotate),n=(t.width-e)/2;t.left+=n,t.right=t.left+e;const o=t.height*A(t.rotate)+t.width*E(t.rotate),i=(o-t.height)/2;t.top-=i,t.bottom=t.top+o,t.width=e,t.height=o}else t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function W(t){const e=t.style;t.propValue.forEach((t=>{if(!Object.keys(t.groupStyle).length){const n={...t.style};t.component.startsWith("SVG")?t.groupStyle=j(n):t.groupStyle=Z(n),t.groupStyle.left=P((n.left-e.left)/e.width),t.groupStyle.top=P((n.top-e.top)/e.height),t.groupStyle.width=P(n.width/e.width),t.groupStyle.height=P(n.height/e.height)}}))}var Y={state:{areaData:{style:{top:0,left:0,width:0,height:0},components:[]},editor:null},mutations:{getEditor(t){t.editor=_("#designer-page")},setAreaData(t,e){t.areaData=e},compose({componentData:t,areaData:e,editor:n}){const o=[];e.components.forEach((t=>{if("Group"!==t.component)o.push(t);else{const e={...t.style},i=t.propValue,r=n.getBoundingClientRect();i.forEach((t=>{N(t,r,e)})),o.push(...t.propValue)}}));const i={id:b(),component:"Group",label:"组合",icon:"zuhe",...L.$Z,style:{...L.zH,...e.style},propValue:o};W(i),it.commit("printTemplateModule/addComponent",{component:i}),M.$emit("hideArea"),it.commit("printTemplateModule/batchDeleteComponent",e.components),it.commit("printTemplateModule/setCurComponent",{component:t[t.length-1],index:t.length-1}),e.components=[]},batchDeleteComponent({componentData:t},e){e.forEach((e=>{for(let n=0,o=t.length;n<o;n++)if(e.id===t[n].id){t.splice(n,1);break}}))},decompose({curComponent:t,editor:e}){const n={...t.style},o=t.propValue,i=e.getBoundingClientRect();it.commit("printTemplateModule/deleteComponent"),o.forEach((t=>{N(t,i,n),it.commit("printTemplateModule/addComponent",{component:t})}))}}};let z=[];function X(){return z}var V={state:{snapshotData:[],snapshotIndex:-1},mutations:{undo(t){if(t.snapshotIndex>=0){t.snapshotIndex--;const e=S(t.snapshotData[t.snapshotIndex])||X();if(t.curComponent){const n=!e.find((e=>t.curComponent.id===e.id));n&&it.commit("setCurComponent",{component:null,index:null})}it.commit("setComponentData",e)}},redo(t){t.snapshotIndex<t.snapshotData.length-1&&(t.snapshotIndex++,it.commit("setComponentData",S(t.snapshotData[t.snapshotIndex])))},recordSnapshot(t){t.snapshotData[++t.snapshotIndex]=S(t.componentData),t.snapshotIndex<t.snapshotData.length-1&&(t.snapshotData=t.snapshotData.slice(0,t.snapshotIndex+1))}}};const F={...Y.state,...V.state,editMode:"edit",pageConfig:{pageSize:"A4",pageDirection:"h",title:"新建模板",scale:1,background:"#ffffff",color:"#212121",fontSize:12,fontFamily:"Microsoft YaHei"},isInEditor:!1,componentData:[],curComponent:null,curComponentIndex:null,isClickComponent:!1},q={},G={...C.mutations,...Y.mutations,...V.mutations,setClickComponentStatus(t,e){t.isClickComponent=e},setEditMode(t,e){t.editMode=e},setInEditorStatus(t,e){t.isInEdiotr=e},setCanvasStyle(t,e){t.canvasStyleData=e},setCurComponent(t,{component:e,index:n}){t.curComponent=e,t.curComponentIndex=n},setShapeStyle({curComponent:t},{top:e,left:n,width:o,height:i,rotate:r}){e&&(t.style.top=Math.round(e)),n&&(t.style.left=Math.round(n)),o&&(t.style.width=Math.round(o)),i&&(t.style.height=Math.round(i)),r&&(t.style.rotate=Math.round(r))},setShapeSingleStyle({curComponent:t},{key:e,value:n}){t.style[e]=n},setComponentData(t,e=[]){o["default"].set(t,"componentData",e)},addComponent(t,{component:e,index:n}){void 0!==n?t.componentData.splice(n,0,e):t.componentData.push(e)},deleteComponent(t,e){void 0===e&&(e=t.curComponentIndex),e===t.curComponentIndex&&(t.curComponentIndex=null,t.curComponent=null),/\d/.test(e)&&t.componentData.splice(e,1)}},U={};var J={STORAGE_PREFIX:"_ROY_DESIGNER_",MIN_SCALE:.25,MAX_SCALE:2};const{STORAGE_PREFIX:K}=J;var Q={namespaced:!0,state:()=>({isNightMode:!1}),mutations:{setIsNightMode(t,e){t.isNightMode=e.isNightMode}},actions:{toggleNightMode({commit:t},e){window.localStorage.setItem(`${K}NIGHT_MODE`,JSON.stringify(e)),document.getElementById("roy-print-template-designer").setAttribute("theme",e?"dark":"day"),t("setIsNightMode",{isNightMode:e})},async initNightMode({dispatch:t}){const e=window.localStorage.getItem(`${K}NIGHT_MODE`);null!==e&&await t("toggleNightMode",JSON.parse(e))}}},tt=n(6389);const{MIN_SCALE:et,MAX_SCALE:nt}=J;var ot={namespaced:!0,state:()=>({scale:5,rectWidth:210,rectHeight:297,needReDrawRuler:0,showRuler:!0}),mutations:{setScale(t,e){let n=new tt.Z(e.scale);t.scale=new tt.Z(n).times(new tt.Z(5))},setBiggerScale(t){let e=new tt.Z(t.scale),n=e.div(new tt.Z(5)),o=new tt.Z(.1),i=n.plus(o).toNumber(),r=i>nt?nt:i;t.scale=new tt.Z(r).times(new tt.Z(5))},setSmallerScale(t){let e=new tt.Z(t.scale),n=e.div(new tt.Z(5)),o=new tt.Z(.1),i=n.minus(o).toNumber(),r=i<et?et:i;t.scale=new tt.Z(r).times(new tt.Z(5))},setReDrawRuler(t){t.needReDrawRuler+=1},setRect(t,e){t.rectWidth=e.w,t.rectHeight=e.h},rotateRect(t){const e=t.rectHeight;t.rectHeight=Number(t.rectWidth),t.rectWidth=Number(e)},toggleRuler(t){t.showRuler=!t.showRuler}},actions:{setBiggerScale({commit:t}){t("setBiggerScale")},setSmallerScale({commit:t}){t("setSmallerScale")},setScale({commit:t},e){t("setScale",{scale:e})},reDrawRuler({commit:t}){t("setReDrawRuler")},setRect({commit:t},e){t("setRect",e)},rotateRect({commit:t}){t("rotateRect")},toggleRuler({commit:t}){t("toggleRuler")}}},it={namespaced:!0,state:F,mutations:G,actions:U,getters:q,modules:{nightMode:Q,rulerThings:ot}};o["default"].use(i.ZP);var rt=new i.ZP.Store({modules:{printTemplateModule:it}}),st=function(){var t=this,e=t._self._c;return e("PtdDesigner",{ref:"designer",scopedSlots:t._u([{key:"roy-designer-header-slot",fn:function(){return[e("div",{staticClass:"head-slot"},[e("el-button",{attrs:{id:"royians-guide",icon:"ri-question-line",size:"mini"},on:{click:t.showUserGuide}},[t._v(" 界面指引 ")]),e("el-button",{attrs:{icon:"ri-printer-cloud-line",size:"mini"},on:{click:t.printPreview}},[t._v(" 打印预览 ")]),e("el-button",{attrs:{icon:"ri-file-pdf-line",size:"mini"},on:{click:t.exportPDF}},[t._v(" 导出PDF ")]),e("el-button",{attrs:{icon:"ri-braces-line",size:"mini"},on:{click:t.exportJSON}},[t._v(" 导出配置信息 ")]),t._l(t.headIconConfig,(function(t,n){return e("i",{key:n,staticClass:"roy-header-icon",class:t.icon,on:{click:t.event}})}))],2)]},proxy:!0},{key:"roy-designer-toolbar-slot",fn:function(){return t._l(t.toolbarSlotConfig,(function(t,n){return e("el-tooltip",{key:n,attrs:{content:t.name,"open-delay":600,"visible-arrow":!1,effect:"dark",placement:"bottom"}},[e("div",{staticClass:"toolbar-slot-item",on:{click:t.event}},[e("i",{class:t.icon})])])}))},proxy:!0}])})},at=[],lt=n(5158),ct={useModalOverlay:!0,keyboardNavigation:!0,defaultStepOptions:{cancelIcon:{enabled:!0},scrollTo:{behavior:"smooth",block:"center"},modalOverlayOpeningPadding:8,modalOverlayOpeningRadius:4,buttons:[{action(){return this.back()},text:"上一步"},{action(){return this.next()},text:"下一步"}]}};const ut=(t={})=>{const e={...ct,...t};return new lt.Z.Tour(e)};var dt=ut,ht={name:"App",mounted(){v("欢迎使用ROYIANS的打印模板设计器，仅个人学习使用","info")},data(){return{toolbarSlotConfig:[{name:"从报表配置拉取表格",icon:"ri-table-line",event:()=>{v("从报表配置拉取表格(开发者自定义事件)")}}],headIconConfig:[{name:"Github",icon:"ri-github-fill",event:()=>{v("跳转到Github","info"),window.open("https://github.com/ROYIANS/print-template-designer","_blank")}}]}},methods:{showUserGuide(){const t=dt();t.addSteps([{attachTo:{element:document.querySelector("#royians-guide"),on:"auto"},title:"打印模板设计器界面指引",text:"欢迎使用！接下来介绍整个界面。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-header"),on:"auto"},title:"打印模板设计器界面指引",text:"这是标题栏，左侧显示”打印模板设计器”字样和当前模板名称，右侧是开发者自定义插槽和夜间模式切换按钮。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-aside"),on:"auto"},title:"打印模板设计器界面指引",text:"这是左侧面板，包含四个模块。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-main"),on:"bottom-start"},title:"打印模板设计器界面指引",text:"这是右侧面版，包含一个工具栏和一个主窗口。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:document.querySelector("#royians-guide"),on:"auto"},title:"打印模板设计器界面指引",text:"本系统由ROYIANS设计，欢迎使用。",buttons:[{action(){return this.cancel()},text:"完成"}]}]),t.start()},exportJSON(){v("导出成功，请查看控制台！","success")},exportPDF(){},printPreview(){}}},mt=ht,pt=(0,c.Z)(mt,st,at,!1,null,null,null),ft=pt.exports,gt=n(8499),yt=n.n(gt),vt=n(2631);o["default"].use(vt.ZP);const xt=[],Ct=new vt.ZP({mode:"history",base:"/",routes:xt});var wt=Ct,bt=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"roy-designer-container",attrs:{id:"roy-print-template-designer",theme:"day"}},[e("el-header",{staticClass:"roy-designer-header",attrs:{height:"40px"}},[e("div",{staticClass:"roy-designer-header__text"},[e("i",{staticClass:"ri-pen-nib-line"}),e("span",[t._v("打印模板设计器 | 新建模板")])]),e("div",{staticClass:"roy-designer__right"},[e("div",[t._t("roy-designer-header-slot")],2),e("div",{staticClass:"roy-night-mode"},[e("transition-group",{attrs:{name:"roy-fade",tag:"span"}},[t.isNightMode?e("i",{key:1,staticClass:"ri-haze-fill",on:{click:t.dayNightChange}}):e("i",{key:2,staticClass:"ri-moon-foggy-fill",on:{click:t.dayNightChange}})])],1)])]),e("el-container",{staticStyle:{height:"calc(100% - 40px)"}},[e("el-aside",{staticClass:"roy-designer-aside",attrs:{width:"auto"}},[e("DesignerAside",{attrs:{"show-right":t.defaultExpendAside},on:{"update:showRight":function(e){t.defaultExpendAside=e},"update:show-right":function(e){t.defaultExpendAside=e}}})],1),e("el-main",{staticClass:"roy-designer-main"},[e("DesignerMain",{attrs:{"show-right":t.defaultExpendAside},scopedSlots:t._u([{key:"roy-designer-toolbar-slot",fn:function(){return[t._t("roy-designer-toolbar-slot")]},proxy:!0}],null,!0)})],1)],1)],1)},Mt=[],St={i8:"0.0.6"},_t=function(){var t=this,e=t._self._c;return e("section",{staticClass:"roy-designer-aside__main",style:t.asideStyle},[e("el-menu",{staticClass:"roy-designer-aside__menu",attrs:{collapse:!0,"default-active":"0"},on:{select:t.onMenuSelect}},t._l(t.menuList,(function(n,o){return e("el-menu-item",{key:n.code,attrs:{index:`${o}`}},[e("div",{staticClass:"roy-designer-aside__menu__icon"},[e("i",{class:n.icon}),e("span",[t._v(t._s(n.name))])])])})),1),e("keep-alive",[e(t.curActiveComponent,{directives:[{name:"show",rawName:"v-show",value:t.showRight,expression:"showRight"}],key:t.curActiveComponentCode,tag:"component",staticClass:"roy-designer-aside__right_panel"})],1)],1)},kt=[],Tt=n(1917),$t={name:"DesignerAside",mixins:[Tt.Z],data(){return{menuList:[{name:"组件",code:"component",icon:"ri-drag-drop-fill",component:()=>n.e(258).then(n.bind(n,258))},{name:"结构",code:"toc",icon:"ri-node-tree",component:()=>n.e(133).then(n.bind(n,1133))},{name:"属性",code:"palette",icon:"ri-palette-line",component:()=>n.e(312).then(n.bind(n,4312))},{name:"全局",code:"setting",icon:"ri-sound-module-line",component:()=>n.e(509).then(n.bind(n,9509))}],curActiveComponent:null,curActiveComponentCode:""}},props:{showRight:{type:Boolean,default:!0}},computed:{asideStyle(){return this.showRight?"width: 300px":"width: 65px"}},methods:{onMenuSelect(t){this.curActiveComponentCode===this.menuList[t].code?this.$emit("update:showRight",!this.showRight):this.$emit("update:showRight",!0),this.curActiveComponent=this.menuList[t].component,this.curActiveComponentCode=this.menuList[t].code}},mounted(){this.curActiveComponent=this.menuList[0].component,this.curActiveComponentCode=this.menuList[0].code}},Rt=$t,Dt=(0,c.Z)(Rt,_t,kt,!1,null,"7d776c28",null),Et=Dt.exports,At=function(){var t=this,e=t._self._c;return e("section",{staticClass:"height-all"},[e("ToolBar",{scopedSlots:t._u([{key:"roy-designer-toolbar-slot",fn:function(){return[t._t("roy-designer-toolbar-slot")]},proxy:!0}],null,!0)}),e("div",{on:{drop:t.handleDrop,dragover:t.handleDragOver,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor",{attrs:{"show-right":t.showRight}})],1)],1)},It=[],Pt=function(){var t=this,e=t._self._c;return e("el-header",{staticClass:"roy-designer-main__toolbar",attrs:{height:"45px"}},[e("section",{staticClass:"roy-designer-main__toolbar_left"},t._l(t.toolbarLeftConfig,(function(t,n){return e("el-tooltip",{key:n,attrs:{content:t.name,"open-delay":600,"visible-arrow":!1,effect:"dark",placement:"bottom"}},[e("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:t.event}},[e("i",{class:t.icon})])])})),1),e("section",[t._t("roy-designer-toolbar-slot")],2),e("section",{staticClass:"roy-designer-main__toolbar_right"},[e("div",{staticClass:"roy-designer-main__toolbar__setting"},[e("span",[t._v(t._s(t.rectWidth)+"/"+t._s(t.rectHeight))])]),e("div",{staticClass:"roy-designer-main__toolbar__zoom"},[e("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.smallerScale.apply(null,arguments)}}},[e("i",{staticClass:"ri-zoom-out-line"})]),e("span",[t._v(t._s(t.scale100)+"%")]),e("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.biggerScale.apply(null,arguments)}}},[e("i",{staticClass:"ri-zoom-in-line"})])])])])},Nt=[],Lt=n(1164),Ot=n(2269),Bt=n.n(Ot),jt={name:"ToolBar",mixins:[Tt.Z],components:{},props:{},data(){return{toolbarLeftConfig:[{name:"撤销",icon:"ri-arrow-go-back-fill",event:()=>{v("撤销")}},{name:"恢复",icon:"ri-arrow-go-forward-fill",event:()=>{v("恢复")}},{name:"显示/隐藏标尺",icon:"ri-ruler-2-line",event:()=>{this.toggleRuler()}},{name:"锁定",icon:"ri-lock-2-line",event:()=>{v("锁定"),Bt()(document.querySelector("#designer-page"),{scale:"5"}).then((t=>{let e=new Lt.kH;e.addImage(t.toDataURL("image/jpeg"),"JPEG",0,0,210,297),e.save("a4.pdf")}))}},{name:"组合/拆分",icon:"ri-collage-line",event:()=>{v("组合/拆分")}},{name:"切换纸张方向",icon:"ri-clockwise-line",event:()=>{this.rotatePage()}}]}},computed:{...(0,i.rn)({scale:t=>t.printTemplateModule.rulerThings.scale,rectWidth:t=>t.printTemplateModule.rulerThings.rectWidth,rectHeight:t=>t.printTemplateModule.rulerThings.rectHeight}),scale100(){let t=new tt.Z(this.scale).div(new tt.Z(5)),e=new tt.Z(100);return t.mul(e).toNumber()}},methods:{...(0,i.nv)({setBiggerScale:"printTemplateModule/rulerThings/setBiggerScale",setSmallerScale:"printTemplateModule/rulerThings/setSmallerScale",reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setRect:"printTemplateModule/rulerThings/setRect",rotateRect:"printTemplateModule/rulerThings/rotateRect",toggleRuler:"printTemplateModule/rulerThings/toggleRuler"}),smallerScale(){this.setSmallerScale(),this.reDrawRuler()},biggerScale(){this.setBiggerScale(),this.reDrawRuler()},rotatePage(){this.rotateRect(),this.reDrawRuler()},initMounted(){}},created(){},mounted(){this.initMounted()},watch:{}},Zt=jt,Ht=(0,c.Z)(Zt,Pt,Nt,!1,null,"4533f3c4",null),Wt=Ht.exports,Yt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-designer-main__page",style:t.panelWidth},[e("SketchRuler",{directives:[{name:"show",rawName:"v-show",value:t.showRuler,expression:"showRuler"}],ref:"sketchRuler",attrs:{lang:t.lang,thick:t.thick,scale:t.realScale,width:t.rulerWidth,height:t.rulerHeight,startX:t.startX,startY:t.startY,shadow:t.shadow,horLineArr:t.lines.h,verLineArr:t.lines.v,cornerActive:!1,palette:t.palette},on:{handleLine:t.handleLine,onCornerClick:t.handleCornerClick}}),e("div",{ref:"screensRef",attrs:{id:"screens"},on:{wheel:t.handleWheel,scroll:t.handleScroll}},[e("div",{ref:"containerRef",staticClass:"screen-container"},[e("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:"contextmenu",expression:"'contextmenu'"}],style:t.canvasStyle,attrs:{id:"designer-page"},on:{mousedown:t.handleMouseDown,contextmenu:t.doing}},t._l(t.componentData,(function(n,o){return e("ComponentAdjuster",{key:n.id,class:{lock:n.isLock},style:t.getShapeStyle(n.style),attrs:{"default-style":n.style,active:n.id===(t.curComponent||{}).id,element:n,index:o}},[e(n.component,{tag:"component",attrs:{id:"roy-component-"+n.id,"prop-value":n.propValue,element:n}})],1)})),1)])]),e("Context",{ref:"contextmenu",attrs:{theme:t.contextTheme}},[e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-list-settings-line"}),e("span",[t._v("属性")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-file-copy-line"}),e("span",[t._v("复制")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-clipboard-line"}),e("span",[t._v("粘贴")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-scissors-cut-line"}),e("span",[t._v("剪切")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-delete-bin-line"}),e("span",[t._v("删除")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-lock-line"}),e("span",[t._v("锁定")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-lock-unlock-line"}),e("span",[t._v("解锁")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-align-top"}),e("span",[t._v("置顶")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-align-bottom"}),e("span",[t._v("置底")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-arrow-up-line"}),e("span",[t._v("上移")])]),e("ContextItem",{on:{click:t.doing}},[e("i",{staticClass:"ri-arrow-down-line"}),e("span",[t._v("下移")])])],1)],1)},zt=[],Xt=n(942),Vt={inserted(t,e,n){const o=n.context.$refs[e.arg]||n.context.$refs[e.value],i="[object Array]"===Object.prototype.toString.call(o)?o[0]:o;i.addRef({el:t,vnode:n}),i.$contextmenuId=t.id||i._uid}},Ft=function(){var t=this,e=t._self._c;return e("ul",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],ref:"contextmenu",class:t.contextmenuCls,style:t.style},[t._t("default")],2)},qt=[],Gt={name:"RoyContext",provide(){return{$$contextmenu:this}},props:{eventType:{type:String,default:"contextmenu"},theme:{type:String,default:"default"},autoPlacement:{type:Boolean,default:!0},disabled:Boolean},data(){return{visible:!1,references:[],style:{top:0,left:0}}},computed:{clickOutsideHandler(){return this.visible?this.hide:()=>{}},isClick(){return"click"===this.eventType},contextmenuCls(){return["roy-context",`roy-context--${this.theme}`]}},watch:{visible(t){t?(this.$emit("show",this),document.body.addEventListener("click",this.handleBodyClick)):(this.$emit("hide",this),document.body.removeEventListener("click",this.handleBodyClick))}},mounted(){document.body.appendChild(this.$el),window.$$VContextmenu?window.$$VContextmenu[this.$contextmenuId]=this:window.$$VContextmenu={[this.$contextmenuId]:this}},beforeDestroy(){document.body.removeChild(this.$el),delete window.$$VContextmenu[this.$contextmenuId],this.references.forEach((t=>{t.el.removeEventListener(this.eventType,this.handleReferenceContextmenu)})),document.body.removeEventListener("click",this.handleBodyClick)},methods:{addRef(t){this.references.push(t),t.el.addEventListener(this.eventType,this.handleReferenceContextmenu)},handleReferenceContextmenu(t){if(t.preventDefault(),this.disabled)return;const e=this.references.find((e=>e.el.contains(t.target)));this.$emit("contextmenu",e?e.vnode:null);const n=t.pageX,o=t.pageY;this.show(),this.$nextTick((()=>{const t={top:o,left:n};if(this.autoPlacement){const e=this.$refs.contextmenu.clientWidth,i=this.$refs.contextmenu.clientHeight;i+o>=window.innerHeight&&(t.top-=i),e+n>=window.innerWidth&&(t.left-=e)}this.style={top:`${t.top}px`,left:`${t.left}px`}}))},handleBodyClick(t){const e=this.$el.contains(t.target)||this.isClick&&this.references.some((e=>e.el.contains(t.target)));e||(this.visible=!1)},show(t){Object.keys(window.$$VContextmenu).forEach((t=>{t!==this.$contextmenuId&&window.$$VContextmenu[t].hide()})),t&&(this.style={top:`${t.top}px`,left:`${t.left}px`}),this.visible=!0},hide(){this.visible=!1},hideAll(){Object.keys(window.$$VContextmenu).forEach((t=>{window.$$VContextmenu[t].hide()}))}}},Ut=Gt,Jt=(0,c.Z)(Ut,Ft,qt,!1,null,null,null),Kt=Jt.exports,Qt=function(){var t=this,e=t._self._c;return t.divider?e("li",{staticClass:"roy-context-divider"}):e("li",{class:t.classname,on:{click:t.handleClick,mouseenter:t.handleMouseenter,mouseleave:t.handleMouseleave}},[t._t("default")],2)},te=[],ee={name:"ContextItem",inject:["$$contextmenu"],props:{divider:Boolean,disabled:Boolean,autoHide:{type:Boolean,default:!0}},data(){return{hover:!1}},computed:{classname(){return{"roy-context-item":!this.divider,"roy-context-item--hover":this.hover,"roy-context-item--disabled":this.disabled}}},methods:{handleMouseenter(t){this.disabled||(this.hover=!0,this.$emit("mouseenter",this,t))},handleMouseleave(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))},handleClick(t){this.disabled||(this.$emit("click",this,t),this.autoHide&&this.$$contextmenu.hide())}}},ne=ee,oe=(0,c.Z)(ne,Qt,te,!1,null,null,null),ie=oe.exports,re=function(){var t=this,e=t._self._c;return e("li",{staticClass:"v-contextmenu-group"},[e("ul",{staticClass:"v-contextmenu-group__menus",style:t.menusStyle},[t._t("default")],2)])},se=[],ae={name:"ContextGroup",props:{maxWidth:{type:[Number,String],default:void 0}},computed:{menusStyle(){return this.maxWidth?{"max-width":"number"===typeof this.maxWidth?`${this.maxWidth}px`:this.maxWidth,"overflow-x":"auto"}:null}}},le=ae,ce=(0,c.Z)(le,re,se,!1,null,null,null),ue=(ce.exports,function(){var t=this,e=t._self._c;return e("li",{class:t.classname,on:{mouseenter:t.handleMouseenter,mouseleave:t.handleMouseleave}},[e("span",{staticClass:"v-contextmenu-submenu__title"},[t._t("title",(function(){return[t._v(t._s(t.title))]})),e("span",{staticClass:"v-contextmenu-iconfont v-contextmenu-submenu__icon"})],2),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.hover,expression:"hover"}],ref:"submenu",class:t.submenuCls},[t._t("default")],2)])}),de=[],he={name:"VContextmenuSubmenu",props:{title:{type:String,default:""},disabled:Boolean},data(){return{hover:!1,submenuPlacement:[]}},computed:{classname(){return{"v-contextmenu-item":!0,"v-contextmenu-submenu":!0,"v-contextmenu-item--hover":this.hover,"v-contextmenu-item--disabled":this.disabled}},submenuCls(){return["v-contextmenu",...this.submenuPlacement]}},methods:{handleMouseenter(t){if(this.disabled)return;const{target:e}=t,n=e.getBoundingClientRect();this.hover=!0,this.$emit("mouseenter",this,t),this.$nextTick((()=>{const t=this.$refs.submenu.clientWidth,e=this.$refs.submenu.clientHeight,o=[];n.right+t>=window.innerWidth?o.push("left"):o.push("right"),n.bottom+e>=window.innerHeight?o.push("bottom"):o.push("top"),this.submenuPlacement=o}))},handleMouseleave(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))}}},me=he,pe=(0,c.Z)(me,ue,de,!1,null,null,null),fe=(pe.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-component-adjuster",style:t.adjusterStyle,on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"ri-checkbox-blank-circle-line roy-component-adjuster__rotate",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"ri-lock-fill roy-component-adjuster__lock"}),t._l(t.isActive?t.pointList:[],(function(n){return e("div",{key:n,class:`roy-component-adjuster__shape-point--${n}`,style:t.getPointStyle(n),on:{mousedown:function(e){return t.handleMouseDownOnPoint(n,e)}}})})),t._t("default")],2)}),ge=[];const ye=30,ve=30,xe={lt:Ce,t:Se,rt:we,r:_e,rb:be,b:ke,lb:Me,l:Te};function Ce(t,e,n,o,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=l.x-a.x,u=l.y-a.y;if(o){c/u>n?(a.x+=Math.abs(c-u*n),c=u*n):(a.y+=Math.abs(u-c/n),u=c/n);const e=R(a,s,t.rotate);s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=l.x-a.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ye),t.height=Math.max(Math.round(u),ve),t.left=Math.round(a.x),t.top=Math.round(a.y))}function we(t,e,n,o,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=a.x-l.x,u=l.y-a.y;if(o){c/u>n?(a.x-=Math.abs(c-u*n),c=u*n):(a.y+=Math.abs(u-c/n),u=c/n);const e=R(a,s,t.rotate);s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=a.x-l.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ye),t.height=Math.max(Math.round(u),ve),t.left=Math.round(l.x),t.top=Math.round(a.y))}function be(t,e,n,o,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=l.x-a.x,u=l.y-a.y;if(o){c/u>n?(l.x-=Math.abs(c-u*n),c=u*n):(l.y-=Math.abs(u-c/n),u=c/n);const e=R(l,s,t.rotate);s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=l.x-a.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ye),t.height=Math.max(Math.round(u),ve),t.left=Math.round(a.x),t.top=Math.round(a.y))}function Me(t,e,n,o,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=a.x-l.x,u=l.y-a.y;if(o){c/u>n?(l.x+=Math.abs(c-u*n),c=u*n):(l.y-=Math.abs(u-c/n),u=c/n);const e=R(l,s,t.rotate);s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=a.x-l.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ye),t.height=Math.max(Math.round(u),ve),t.left=Math.round(l.x),t.top=Math.round(a.y))}function Se(t,e,n,o,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:s.x,y:a.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.width;o&&(d=c*n),t.width=Math.max(d,ye),t.height=Math.max(Math.round(c),ve),t.top=Math.round(u.y-c/2),t.left=Math.round(u.x-t.width/2)}function _e(t,e,n,o,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:a.x,y:s.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.height;o&&(d=c/n),t.height=Math.max(d,ve),t.width=Math.max(Math.round(c),ye),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-c/2)}function ke(t,e,n,o,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:s.x,y:a.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.width;o&&(d=c*n),t.width=Math.max(d,ye),t.height=Math.max(Math.round(c),ve),t.top=Math.round(u.y-c/2),t.left=Math.round(u.x-t.width/2)}function Te(t,e,n,o,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:a.x,y:s.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.height;o&&(d=c/n),t.height=Math.max(d,ve),t.width=Math.max(Math.round(c),ye),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-c/2)}function $e(t,e,n,o,i,r){xe[t](e,n,o,i,r)}var Re={name:"ComponentAdjuster",mixins:[Tt.Z],components:{},props:{active:{type:Boolean,default:!1},element:{required:!0,type:Object,default:()=>{}},defaultStyle:{required:!0,type:Object,default:()=>{}},index:{required:!0,type:[Number,String],default:0}},data(){return{cursors:{},initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}]}},computed:{...(0,i.rn)({editor:t=>t.printTemplateModule.editor}),pointList(){return"RoyLine"===this.element.component?["r","l"]:["lt","t","rt","r","rb","b","lb","l"]},isActive(){return this.active&&!this.element.isLock},adjusterStyle(){return{border:this.isActive?"0.5px dashed var(--roy-text-color-secondary)":void 0}}},methods:{initMounted(){this.cursors=this.getCursor()},getPointStyle(t){const{width:e,height:n}=this.defaultStyle,o=/t/.test(t),i=/b/.test(t),r=/l/.test(t),s=/r/.test(t);let a=0,l=0;return 2===t.length?(a=r?0:e,l=o?0:n):((o||i)&&(a=e/2,l=o?0:n),(r||s)&&(a=r?0:e,l=Math.floor(n/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${a}px`,top:`${l}px`,cursor:this.cursors[t]}},getCursor(){const t=I(0),e={};let n=-1;return this.pointList.forEach((o=>{const i=I(this.initialAngle[o]+t),r=this.angleToCursor.length;while(1){n=(n+1)%r;const t=this.angleToCursor[n];if(i<23||i>=338)return void(e[o]="nw-resize");if(t.start<=i&&i<t.end)return void(e[o]=t.cursor+"-resize")}})),e},handleRotate(t){this.$store.commit("printTemplateModule/setClickComponentStatus",!0),t.preventDefault(),t.stopPropagation();const e={...this.defaultStyle},n=t.clientY,o=t.clientX,i=e.rotate,r=this.$el.getBoundingClientRect(),s=r.left+r.width/2,a=r.top+r.height/2,l=Math.atan2(n-a,o-s)/(Math.PI/180);let c=!1;const u=t=>{c=!0;const n=t.clientX,o=t.clientY,r=Math.atan2(o-a,n-s)/(Math.PI/180);e.rotate=i+r-l,this.$store.commit("printTemplateModule/setShapeStyle",e)},d=()=>{c&&this.$store.commit("printTemplateModule/recordSnapshot"),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),this.cursors=this.getCursor()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)},handleMouseDownOnPoint(t,e){this.$store.commit("printTemplateModule/setInEditorStatus",!0),this.$store.commit("printTemplateModule/setClickComponentStatus",!0),e.stopPropagation(),e.preventDefault();const n={...this.defaultStyle},o=n.width/n.height,i={x:n.left+n.width/2,y:n.top+n.height/2},r=this.editor.getBoundingClientRect(),s=e.target.getBoundingClientRect(),a={x:Math.round(s.left-r.left+e.target.offsetWidth/2),y:Math.round(s.top-r.top+e.target.offsetHeight/2)},l={x:i.x-(a.x-i.x),y:i.y-(a.y-i.y)};let c=!1,u=!0;const d=this.isNeedLockProportion(),h=e=>{if(u)return void(u=!1);c=!0;const s={x:e.clientX-Math.round(r.left),y:e.clientY-Math.round(r.top)};$e(t,n,s,o,d,{center:i,curPoint:a,symmetricPoint:l}),this.$store.commit("printTemplateModule/setShapeStyle",n)},m=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",m),c&&this.$store.commit("printTemplateModule/recordSnapshot")};document.addEventListener("mousemove",h),document.addEventListener("mouseup",m)},isNeedLockProportion(){if("RoyGroup"!==this.element.component)return!1;const t=[0,90,180,360];for(const e of this.element.propValue)if(!t.includes(I(parseInt(e.style.rotate))))return!0;return!1},selectCurComponent(t){t.stopPropagation(),t.preventDefault()},handleMouseDownOnShape(t){if(this.$nextTick((()=>M.$emit("componentClick"))),this.$store.commit("printTemplateModule/setInEditorStatus",!0),this.$store.commit("printTemplateModule/setClickComponentStatus",!0),T(this.element.component)&&t.preventDefault(),t.stopPropagation(),this.$store.commit("printTemplateModule/setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const e={...this.defaultStyle},n=t.clientY,o=t.clientX,i=Number(e.top),r=Number(e.left);let s=!1;const a=t=>{s=!0;const a=t.clientX,l=t.clientY,c=this.editor;e.top=Math.min(Math.max(0,l-n+i),c.offsetHeight-e.height),e.left=Math.min(Math.max(0,a-o+r),c.offsetWidth-e.width),this.$store.commit("printTemplateModule/setShapeStyle",e),this.$nextTick((()=>{M.$emit("move",l-n>0,a-o>0)}))},l=()=>{s&&this.$store.commit("printTemplateModule/recordSnapshot"),M.$emit("unmove"),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)}},created(){},mounted(){this.initMounted()},watch:{}},De=Re,Ee=(0,c.Z)(De,fe,ge,!1,null,null,null),Ae=Ee.exports,Ie=n(8701),Pe=n.n(Ie),Ne=n(3774);const Le={color:{type:String,default:"#212121"},background:{type:String,default:"#FFFFFF"},border:{type:String,default:"none"},borderRadius:{type:String,default:"inherit"},padding:{type:String,default:"0 0 0 0"},margin:{type:String,default:"0 0 0 0"},fontSize:{type:Number,default:12},zIndex:{type:Number,default:1}},Oe=Object.assign(Le,{}),Be=(0,Ne.ZP)("div",Oe)`
  position: absolute;
  color: ${t=>t.color};
  background: ${t=>t.background};
  border: ${t=>t.border};
  border-radius: ${t=>t.borderRadius};
  padding: ${t=>t.padding};
  margin: ${t=>t.margin};
  font-size: ${t=>`${t.fontSize}pt`};
  z-index: ${t=>t.zIndex};
`;var je={name:"RoyText",props:{element:{type:Object,default:()=>{}},propValue:{type:String,default:""}},render(){const t=arguments[0],e=this.element.style||{};return t(Be,Pe()([{},{props:e}]),[t("div",{domProps:{innerHTML:this.propValue}})])}};const{MIN_SCALE:Ze,MAX_SCALE:He}=J;var We={name:"RoyEditor",directives:{contextmenu:Vt},mixins:[Tt.Z],components:{SketchRuler:Xt.Z,Context:Kt,ContextItem:ie,ComponentAdjuster:Ae,RoyText:je},props:{showRight:{type:Boolean,default:!0}},data(){return{rulerWidth:0,rulerHeight:0,startX:-19,startY:-25,lines:{h:[],v:[]},thick:20,lang:"zh-CN",isShowRuler:!0,isShowReferLine:!0,palette:{bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#4579e1",borderColor:"#DADADC",cornerActiveColor:"#4579e1"},editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1,svgFilterAttrs:["width","height","top","left","rotate"]}},computed:{...(0,i.rn)({realScale:t=>t.printTemplateModule.rulerThings.scale,rectWidth:t=>t.printTemplateModule.rulerThings.rectWidth,rectHeight:t=>t.printTemplateModule.rulerThings.rectHeight,needReDrawRuler:t=>t.printTemplateModule.rulerThings.needReDrawRuler,showRuler:t=>t.printTemplateModule.rulerThings.showRuler,componentData:t=>t.printTemplateModule.componentData,curComponent:t=>t.printTemplateModule.curComponent,editor:t=>t.printTemplateModule.editor}),contextTheme(){return this.isNightMode?"dark":"default"},scale(){return new tt.Z(this.realScale).div(new tt.Z(5))},shadow(){return{x:0,y:0,width:this.rectWidth,height:this.rectHeight}},canvasStyle(){return{width:5*this.rectWidth+"px",height:5*this.rectHeight+"px",transform:`scale(${this.scale})`}},isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode},panelWidth(){return this.showRight?"width: calc(100vw - 330px);":"width: calc(100vw - 95px);"}},methods:{...(0,i.nv)({reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setScale:"printTemplateModule/rulerThings/setScale"}),getShapeStyle:O,handleMouseDown(t){this.curComponent&&!T(this.curComponent.component)||t.preventDefault(),this.hideArea();const e=this.editor.getBoundingClientRect();this.editorX=e.x,this.editorY=e.y;const n=t.clientX,o=t.clientY;this.start.x=n-this.editorX,this.start.y=o-this.editorY,this.isShowArea=!0;const i=t=>{this.width=Math.abs(t.clientX-n),this.height=Math.abs(t.clientY-o),t.clientX<n&&(this.start.x=t.clientX-this.editorX),t.clientY<o&&(this.start.y=t.clientY-this.editorY)},r=t=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),t.clientX!==n||t.clientY!==o?this.createGroup():this.hideArea()};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)},doing(){v("正在制作中...")},hideArea(){this.isShowArea=0,this.width=0,this.height=0,this.$store.commit("printTemplateModule/setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},createGroup(){const t=this.getSelectArea();if(t.length<=1)return void this.hideArea();let e=1/0,n=1/0,o=-1/0,i=-1/0;t.forEach((t=>{let r={};"Group"===t.component?t.propValue.forEach((t=>{const s=_(`#roy-component-${t.id}`).getBoundingClientRect();r.left=s.left-this.editorX,r.top=s.top-this.editorY,r.right=s.right-this.editorX,r.bottom=s.bottom-this.editorY,r.left<n&&(n=r.left),r.top<e&&(e=r.top),r.right>o&&(o=r.right),r.bottom>i&&(i=r.bottom)})):r=H(t.style),r.left<n&&(n=r.left),r.top<e&&(e=r.top),r.right>o&&(o=r.right),r.bottom>i&&(i=r.bottom)})),this.start.x=n,this.start.y=e,this.width=o-n,this.height=i-e,this.$store.commit("printTemplateModule/setAreaData",{style:{left:n,top:e,width:this.width,height:this.height},components:t})},getSelectArea(){const t=[],{x:e,y:n}=this.start;return this.componentData.forEach((o=>{if(o.isLock)return;const{left:i,top:r,width:s,height:a}=H(o.style);e<=i&&n<=r&&i+s<=e+this.width&&r+a<=n+this.height&&t.push(o)})),t},handleLine(t){this.lines=t},handleCornerClick(){},handleScroll(){const t=document.querySelector("#screens").getBoundingClientRect(),e=document.querySelector("#designer-page").getBoundingClientRect(),n=(t.left+this.thick-e.left)/this.realScale,o=(t.top+this.thick-e.top)/this.realScale;this.startX=n,this.startY=o},handleWheel(t){if(t.ctrlKey||t.metaKey){t.preventDefault();const e=parseFloat(Math.max(.2,this.scale-t.deltaY/500).toFixed(2));e<=He&&e>=Ze&&this.setScale(e)}this.$nextTick((()=>{this.handleScroll()}))}},mounted(){this.rulerWidth=this.$el.offsetWidth,this.rulerHeight=this.$el.offsetHeight,this.$refs.screensRef.scrollLeft=this.$refs.containerRef.getBoundingClientRect().width/2-this.rectWidth,this.$store.commit("printTemplateModule/getEditor")},watch:{isNightMode:{handler(t){this.palette={bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:t?"#444444":"#E8E8E8",lineColor:"#4579e1",borderColor:t?"#636466":"#DADADC",cornerActiveColor:"#4579e1"},this.reDrawRuler()}},showRight:{handler(){this.$nextTick((()=>{this.rulerWidth=this.$el.offsetWidth,this.rulerHeight=this.$el.offsetHeight,this.$refs.screensRef.scrollLeft=this.$refs.containerRef.getBoundingClientRect().width/2-this.rectWidth,this.reDrawRuler()}))}},needReDrawRuler:{handler(){this.$nextTick((()=>{this.handleScroll(),this.$refs.sketchRuler?.$children[0]?.$children[0]?.drawRuler(),this.$refs.sketchRuler?.$children[1]?.$children[0]?.drawRuler()}))}}}},Ye=We,ze=(0,c.Z)(Ye,Yt,zt,!1,null,null,null),Xe=ze.exports,Ve={name:"DesignerMain",mixins:[Tt.Z],components:{ToolBar:Wt,Editor:Xe},props:{showRight:{type:Boolean,default:!0}},data(){return{}},computed:{...(0,i.rn)({isClickComponent:t=>t.printTemplateModule.isClickComponent})},methods:{initMounted(){},handleDrop(t){t.preventDefault(),t.stopPropagation();const e=t.dataTransfer.getData("index"),n=document.querySelector("#designer-page").getBoundingClientRect();if(e){const o=this.deepCopy(L.sy[e]);o.style=o.style||{},o.style.top=t.clientY-n.y,o.style.left=t.clientX-n.x,o.id=this.getUuid(),o.label=`${o.name}-${o.id}`,this.$store.commit("printTemplateModule/addComponent",{component:o}),this.$store.commit("printTemplateModule/recordSnapshot")}},handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("printTemplateModule/setClickComponentStatus",!1),this.$store.commit("printTemplateModule/setInEditorStatus",!0)},deselectCurComponent(){this.isClickComponent||this.$store.commit("printTemplateModule/setCurComponent",{component:null,index:null})}},created(){},mounted(){this.initMounted()},watch:{}},Fe=Ve,qe=(0,c.Z)(Fe,At,It,!1,null,null,null),Ge=qe.exports;const Ue=St.i8;var Je={name:"RoyPrintDesigner",components:{DesignerAside:Et,DesignerMain:Ge},props:{},data(){return{defaultExpendAside:!0}},computed:{isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode}},methods:{...(0,i.nv)({initNightMode:"printTemplateModule/nightMode/initNightMode",toggleNightMode:"printTemplateModule/nightMode/toggleNightMode"}),initMounted(){console.log(`\n %c PrintTemplateDesigner® v${Ue} %c ${new Date(window.printTemplateVersionTime||(new Date).getTime()).toLocaleString()}`,"color:#fff;background:linear-gradient(90deg,#4579e1,#009688);padding:5px 0;","color:#000;background:linear-gradient(90deg,#009688,#ffffff);padding:5px 10px 5px 0px;"),this.initConfig()},initConfig(){this.initNightMode()},dayNightChange(){this.toggleNightMode(!this.isNightMode)},enterFullScreen(){}},created(){},mounted(){this.initMounted()},watch:{}},Ke=Je,Qe=(0,c.Z)(Ke,bt,Mt,!1,null,"2e89810a",null),tn=Qe.exports;const en={PtdDesigner:tn},nn=function(t,e={}){nn.installed||(e.store?(e.store.state.printTemplateModule||e.store.registerModule(["printTemplateModule"],it),Object.keys(en).forEach((e=>{t.component(e,en[e])}))):console.warn("[print-template-designer] 请提供store！"))},on={version:"ROY-PRINT-DESIGNER@0.0.6",install:nn};"undefined"!==typeof window&&window.Vue&&nn(window.Vue);var rn=on;o["default"].use(yt(),{size:"small"}),o["default"].use(rn,{store:rt}),o["default"].config.productionTip=!1,new o["default"]({router:wt,store:rt,render:t=>t(ft)}).$mount("#roy-app")},1917:function(t,e,n){n(7658);var o=n(691);e["Z"]={methods:{deepCopy(t,e=[]){if(null===t||"object"!==typeof t)return t;const n=Object.prototype.toString.call(t).slice(8,-1);if("RegExp"===n)return new RegExp(t);if("Date"===n)return new Date(t);if("Error"===n)return new Error(t);const o=e.filter((e=>e.original===t))[0];if(o)return o.copy;const i=Array.isArray(t)?[]:{};return e.push({original:t,copy:i}),Object.keys(t).forEach((n=>{i[n]=this.deepCopy(t[n],e)})),i},getUuid(t=8){return(0,o.x0)(t)},isBlank(t){return void 0===t||null===t||""===t},findParentComponent(t,e){let n=t.$parent;while(n){let t=n.$options.componentName||n.$options.name;if(t===e)return n;n=n.$parent}return!1}}}}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}n.m=t,function(){var t=[];n.O=function(e,o,i,r){if(!o){var s=1/0;for(u=0;u<t.length;u++){o=t[u][0],i=t[u][1],r=t[u][2];for(var a=!0,l=0;l<o.length;l++)(!1&r||s>=r)&&Object.keys(n.O).every((function(t){return n.O[t](o[l])}))?o.splice(l--,1):(a=!1,r<s&&(s=r));if(a){t.splice(u--,1);var c=i();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[o,i,r]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};n.t=function(o,i){if(1&i&&(o=this(o)),8&i)return o;if("object"===typeof o&&o){if(4&i&&o.__esModule)return o;if(16&i&&"function"===typeof o.then)return o}var r=Object.create(null);n.r(r);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&o;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((function(t){s[t]=function(){return o[t]}}));return s["default"]=function(){return o},n.d(r,s),r}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,o){return n.f[o](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{133:"787b2594",258:"cb963ffc",312:"c01717fc",509:"0a83955b",617:"12a1014d",902:"9b09ff7e"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{133:"026ba122",258:"a0983756",312:"1854e2d5",509:"8ff57789"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="print-template-designer:";n.l=function(o,i,r,s){if(t[o])t[o].push(i);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==e+r){a=d;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+r),a.src=o),t[o]=[i];var h=function(e,n){a.onerror=a.onload=null,clearTimeout(m);var i=t[o];if(delete t[o],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((function(t){return t(n)})),e)return e(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/print-template-designer/"}(),function(){var t=function(t,e,n,o){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=function(r){if(i.onerror=i.onload=null,"load"===r.type)n();else{var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.href||e,l=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=s,l.request=a,i.parentNode.removeChild(i),o(l)}};return i.onerror=i.onload=r,i.href=e,document.head.appendChild(i),i},e=function(t,e){for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var i=n[o],r=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(r===t||r===e))return i}var s=document.getElementsByTagName("style");for(o=0;o<s.length;o++){i=s[o],r=i.getAttribute("data-href");if(r===t||r===e)return i}},o=function(o){return new Promise((function(i,r){var s=n.miniCssF(o),a=n.p+s;if(e(s,a))return i();t(o,a,i,r)}))},i={143:0};n.f.miniCss=function(t,e){var n={133:1,258:1,312:1,509:1};i[t]?e.push(i[t]):0!==i[t]&&n[t]&&e.push(i[t]=o(t).then((function(){i[t]=0}),(function(e){throw delete i[t],e})))}}(),function(){var t={143:0};n.f.j=function(e,o){var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)o.push(i[2]);else{var r=new Promise((function(n,o){i=t[e]=[n,o]}));o.push(i[2]=r);var s=n.p+n.u(e),a=new Error,l=function(o){if(n.o(t,e)&&(i=t[e],0!==i&&(t[e]=void 0),i)){var r=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}};n.l(s,l,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,r,s=o[0],a=o[1],l=o[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var u=l(n)}for(e&&e(o);c<s.length;c++)r=s[c],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(u)},o=self["webpackChunkprint_template_designer"]=self["webpackChunkprint_template_designer"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(4535)}));o=n.O(o)})();
//# sourceMappingURL=app.c4a93862.js.map