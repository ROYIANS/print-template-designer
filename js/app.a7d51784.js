(function(){"use strict";var t={28760:function(t,e,o){o.d(e,{$Z:function(){return i},sy:function(){return r},zH:function(){return n}});const n={rotate:0,opacity:1},i={groupStyle:{},isLock:!1},r=[{icon:"ri-text",code:"text",name:"文本",component:"RoySimpleText",propValue:"双击编辑文本",style:{width:200,height:50,fontSize:10,background:void 0,rotate:0},groupStyle:{}},{icon:"ri-t-box-line",code:"long-text",name:"长文本",component:"RoyText",propValue:'<p><span style="font-size: 16pt; font-family: 仿宋;">双击</span><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 16pt; font-family: 仿宋;">编辑</span><span style="font-size: 16pt; font-family: 仿宋;">文本</span></p>',style:{width:500,height:200,fontSize:12,background:void 0,rotate:0},groupStyle:{}},{icon:"ri-table-line",code:"table",name:"表格",component:"RoyTable"},{icon:"ri-layout-2-line",code:"form",name:"表单",component:"RoyForm"},{icon:"iconfont icon-xianduan",code:"line",name:"直线",component:"RoyLine"},{icon:"iconfont icon-xingzhuang-juxing",code:"rectangle",name:"矩形",component:"RoyRect"},{icon:"iconfont icon-xingzhuang-sanjiaoxing",code:"triangle",name:"三角形",component:"RoyTri"},{icon:"iconfont icon-xingzhuang-tuoyuanxing",code:"circle",name:"圆形",component:"RoyCircle"}]},79230:function(t,e,o){var n=o(36369),i=o(63822),r=(o(57658),o(30541),function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"roy-toast roy-toast--center",class:`roy-toast__status--${t.status} ${t.isPaused?"roy-toast--hover-tab":""}`,staticStyle:{width:"auto",opacity:"1"},style:t.positionStyle,on:{mouseenter:t.doPause,mouseleave:t.doContinue}},[e("div"),e("div",{staticClass:"roy-toast__main"},[e("i",{class:t.icon}),t.dangerouslyUseHTMLString?e("span",{staticClass:"roy-toast__message",domProps:{innerHTML:t._s(t.message)}}):e("span",{staticClass:"roy-toast__message"},[t._v(t._s(t.message))])]),e("i",{staticClass:"roy-toast__close ri-close-fill",on:{click:t.close}})]):t._e()}),s=[],a={name:"RoyToast",components:{},props:{},data(){return{visible:!1,dangerouslyUseHTMLString:!1,message:"",status:"",duration:5e3,copiedDuration:0,onClose:null,verticalOffset:0,timer:null,pauseTimer:null,isPaused:!1,tikDownInterval:null}},computed:{icon(){switch(this.status){case"info":return"ri-information-line";case"success":return"ri-checkbox-circle-line";case"warning":return"ri-error-warning-line";case"error":return"ri-close-circle-line";default:return""}},positionStyle(){return{top:`${this.verticalOffset}px`,"--duration":`${Math.floor(this.duration/1e3)}s`}}},methods:{close(){this.visible=!1,this.onClose(this),this.$destroy(),this.$el.parentNode.removeChild(this.$el)},clearTimer(){null!==this.timer&&clearTimeout(this.timer),null!==this.pauseTimer&&clearTimeout(this.pauseTimer),null!==this.tikDownInterval&&clearInterval(this.tikDownInterval)},doPause(){this.pauseTimer=setTimeout((()=>{this.doRestart(!0)}),2e3)},doContinue(){null!==this.timer&&clearTimeout(this.pauseTimer),this.doRestart(!1),this.pauseTimer=null},doRestart(t){t?(this.clearTimer(),this.isPaused=!0):this.isPaused&&(this.startTimer(),this.isPaused=!1)},startTimer(){0===this.copiedDuration&&(this.copiedDuration=this.duration),this.duration>0&&(this.timer=setTimeout((()=>{this.close()}),this.copiedDuration),this.tikDownInterval=setInterval((()=>{this.copiedDuration>1e3&&(this.copiedDuration-=1e3)}),1e3))}},created(){},mounted(){this.startTimer()},beforeDestroy(){this.clearTimer(),this.timer=null,this.pauseTimer=null},watch:{}},l=a,c=o(1001),u=(0,c.Z)(l,r,s,!1,null,null,null),d=u.exports;let h,p=n["default"].extend(d),m=[],f=1,g=function(t={}){let e=t.onClose,o="roy_toast_"+f++;t.onClose=function(){g.close(o,e)},h=new p({data:t}),h.id=o,h.$mount(),document.body.appendChild(h.$el);let n=t.offset||0;return m.forEach((t=>{n+=t.$el.offsetHeight})),h.verticalOffset=n,h.visible=!0,m.push(h),h};g.close=function(t,e){let o,n=m.length,i=-1;for(let r=0;r<n;r++)if(t===m[r].id){o=m[r].$el.offsetHeight,i=r,"function"===typeof e&&e(m[r]),m.splice(r,1);break}if(!(n<=1||-1===i||i>m.length-1))for(let r=i;r<n-1;r++){let t=m[r].$el;t.style["top"]=parseInt(t.style["top"],10)-o+"px"}},g.closeAll=function(){for(let t=m.length-1;t>=0;t--)m[t].close()};var y=g;function x(t="",e="warning",o=3e3){y({status:e,message:t,duration:o})}const v=(t,e,o)=>{const i=t[e];n["default"].set(t,e,t[o]),n["default"].set(t,o,i)};var C={mutations:{upComponent(t){const{componentData:e,curComponentIndex:o}=t;o<e.length-1?(v(e,o,o+1),t.curComponentIndex=o+1):x("已经到顶了")},downComponent(t){const{componentData:e,curComponentIndex:o}=t;o>0?(v(e,o,o-1),t.curComponentIndex=o-1):x("已经到底了")},topComponent(t){const{componentData:e,curComponentIndex:o,curComponent:n}=t;o<e.length-1?(e.splice(o,1),e.push(n),t.curComponentIndex=e.length-1):x("已经到顶了")},bottomComponent(t){const{componentData:e,curComponentIndex:o,curComponent:n}=t;o>0?(e.splice(o,1),e.unshift(n),t.curComponentIndex=0):x("已经到底了")}},actions:{}},b=o(70691);function w(){return(0,b.x0)()}var M=new n["default"];function S(t,e=[]){if(null===t||"object"!==typeof t)return t;const o=Object.prototype.toString.call(t).slice(8,-1);if("RegExp"===o)return new RegExp(t);if("Date"===o)return new Date(t);if("Error"===o)return new Error(t);const n=e.filter((e=>e.original===t))[0];if(n)return n.copy;const i=Array.isArray(t)?[]:{};return e.push({original:t,copy:i}),Object.keys(t).forEach((o=>{i[o]=S(t[o],e)})),i}function $(t){return document.querySelector(t)}const T=["RoyText","RoyRect","RoyCircle","RoyTran"];function _(t){return!T.includes(t)&&!t.startsWith("SVG")}function k(t){return t*Math.PI/180}function R(t,e,o){return{x:(t.x-e.x)*Math.cos(k(o))-(t.y-e.y)*Math.sin(k(o))+e.x,y:(t.x-e.x)*Math.sin(k(o))+(t.y-e.y)*Math.cos(k(o))+e.y}}function D(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}}function E(t){return Math.abs(Math.sin(k(t)))}function N(t){return Math.abs(Math.cos(k(t)))}function A(t){return(t+360)%360}function L(t){return 100*t+"%"}function P(t,e,o){const n=$(`#roy-component-${t.id}`).getBoundingClientRect(),i={x:n.left-e.left+n.width/2,y:n.top-e.top+n.height/2};t.style.rotate=A(t.style.rotate+o.rotate),t.style.width=parseFloat(t.groupStyle.width)/100*o.width,t.style.height=parseFloat(t.groupStyle.height)/100*o.height,t.style.left=i.x-t.style.width/2,t.style.top=i.y-t.style.height/2,t.groupStyle={}}var I=o(28760);function O(t){const e={};return["width","height","top","left","rotate"].forEach((o=>{"rotate"!==o?e[o]=t[o]+"px":e.transform="rotate("+t[o]+"deg)"})),e}const B=["fontSize","width","height","top","left","borderWidth","letterSpacing","borderRadius"];function Z(t,e=[]){const o={};return["opacity","width","height","top","left","rotate","fontSize","fontWeight","lineHeight","letterSpacing","textAlign","color"].forEach((n=>{e.includes(n)||("rotate"!==n?""!==t[n]&&(o[n]=t[n],B.includes(n)&&(o[n]+="px")):o.transform=n+"("+t[n]+"deg)")})),o}function j(t,e=[]){const o={};return Object.keys(t).forEach((n=>{e.includes(n)||("rotate"!==n?""!==t[n]&&(o[n]=t[n],B.includes(n)&&(o[n]+="px")):o.transform=n+"("+t[n]+"deg)")})),o}function H(t){if(t={...t},0!==t.rotate){const e=t.width*N(t.rotate)+t.height*E(t.rotate),o=(t.width-e)/2;t.left+=o,t.right=t.left+e;const n=t.height*N(t.rotate)+t.width*E(t.rotate),i=(n-t.height)/2;t.top-=i,t.bottom=t.top+n,t.width=e,t.height=n}else t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function W(t){const e=t.style;t.propValue.forEach((t=>{if(!Object.keys(t.groupStyle).length){const o={...t.style};t.component.startsWith("SVG")?t.groupStyle=Z(o):t.groupStyle=j(o),t.groupStyle.left=L((o.left-e.left)/e.width),t.groupStyle.top=L((o.top-e.top)/e.height),t.groupStyle.width=L(o.width/e.width),t.groupStyle.height=L(o.height/e.height)}}))}var z={state:{areaData:{style:{top:0,left:0,width:0,height:0},components:[]},editor:null},mutations:{getEditor(t){t.editor=$("#designer-page")},setAreaData(t,e){t.areaData=e},compose({componentData:t,areaData:e,editor:o}){const n=[];e.components.forEach((t=>{if("RoyGroup"!==t.component)n.push(t);else{const e={...t.style},i=t.propValue,r=o.getBoundingClientRect();i.forEach((t=>{P(t,r,e)})),n.push(...t.propValue)}}));const i={id:w(),component:"RoyGroup",label:"组合",icon:"ri-shape-line",...I.$Z,style:{...I.zH,...e.style},propValue:n};W(i),ut.commit("printTemplateModule/addComponent",{component:i}),M.$emit("hideArea"),ut.commit("printTemplateModule/batchDeleteComponent",e.components),ut.commit("printTemplateModule/setCurComponent",{component:t[t.length-1],index:t.length-1}),e.components=[]},batchDeleteComponent({componentData:t},e){e.forEach((e=>{for(let o=0,n=t.length;o<n;o++)if(e.id===t[o].id){t.splice(o,1);break}}))},decompose({curComponent:t,editor:e}){const o={...t.style},n=t.propValue,i=e.getBoundingClientRect();ut.commit("printTemplateModule/deleteComponent"),n.forEach((t=>{P(t,i,o),ut.commit("printTemplateModule/addComponent",{component:t})}))}}};const V=3;let F=[];function Y(){return F}var X={state:{snapshotData:[],snapshotIndex:-1},mutations:{undo(t){if(t.snapshotIndex>=1){t.snapshotIndex--;const e=S(t.snapshotData[t.snapshotIndex])||Y();if(t.curComponent){const o=!e.find((e=>t.curComponent.id===e.id));o&&ut.commit("printTemplateModule/setCurComponent",{component:null,index:null})}ut.commit("printTemplateModule/setComponentData",e)}else x("不能再撤销了")},redo(t){t.snapshotIndex<t.snapshotData.length-1?(t.snapshotIndex++,ut.commit("printTemplateModule/setComponentData",S(t.snapshotData[t.snapshotIndex]))):x("不能再恢复了")},recordSnapshot(t){t.snapshotData[++t.snapshotIndex]=S(t.componentData),t.snapshotIndex<t.snapshotData.length-1&&(t.snapshotData=t.snapshotData.slice(0,t.snapshotIndex+1)),t.snapshotData.length>V&&(t.snapshotData=t.snapshotData.slice(1),t.snapshotIndex--)}}},G={state:{copyData:null,isCut:!1,menuTop:0,menuLeft:0},mutations:{copy(t){t.curComponent?(q(t),U(t),t.isCut=!1):x("请选择组件")},paste(t,e){if(!t.copyData)return void x("请选择组件");const o=t.copyData.data;e?(o.style.top=t.menuTop,o.style.left=t.menuLeft):(o.style.top+=10,o.style.left+=10),o.id=w(),ut.commit("printTemplateModule/addComponent",{component:S(o)}),t.isCut&&(t.copyData=null)},cut(t){t.curComponent?(q(t),U(t),ut.commit("printTemplateModule/deleteComponent"),t.isCut=!0):x("请选择组件")},showContextMenu(t,{top:e,left:o}){t.menuTop=e,t.menuLeft=o}}};function q(t){if(t.isCut&&t.copyData){const e=S(t.copyData.data),o=t.copyData.index;ut.commit("addComponent",{component:e,index:o}),t.curComponentIndex>=o&&t.curComponentIndex++}}function U(t){t.copyData={data:S(t.curComponent),index:t.curComponentIndex}}var J={mutations:{lock({curComponent:t}){n["default"].set(t,"isLock",!0)},unlock({curComponent:t}){n["default"].set(t,"isLock",!1)}}};const K={...z.state,...X.state,...G.state,editMode:"edit",pageConfig:{pageSize:"A4",pageDirection:"h",title:"新建模板",scale:1,background:"#ffffff",color:"#212121",fontSize:12,fontFamily:"Microsoft YaHei"},isInEditor:!1,componentData:[],curComponent:null,curComponentIndex:null,isClickComponent:!1,globalCount:0,paletteCount:0},Q={},tt={...C.mutations,...z.mutations,...X.mutations,...G.mutations,...J.mutations,setClickComponentStatus(t,e){t.isClickComponent=e},setEditMode(t,e){t.editMode=e},setInEditorStatus(t,e){t.isInEdiotr=e},setCanvasStyle(t,e){t.canvasStyleData=e},setCurComponent(t,{component:e,index:o}){t.curComponent=e,t.curComponentIndex=o},setPropValue({componentData:t},{propValue:e,id:o}){if(t.length){let i=null,r=null;for(let n=0;n<t.length;n++)t[n].id===o&&(r=n,i=t[n],i.propValue=e);null!==r&&(n["default"].set(t,r,i),ut.commit("printTemplateModule/recordSnapshot"))}},setShapeStyle({curComponent:t},{top:e,left:o,width:n,height:i,rotate:r}){e&&(t.style.top=Math.round(e)),o&&(t.style.left=Math.round(o)),n&&(t.style.width=Math.round(n)),i&&(t.style.height=Math.round(i)),r&&(t.style.rotate=Math.round(r))},setShapeSingleStyle({curComponent:t},{key:e,value:o}){t.style[e]=o},setComponentData(t,e=[]){n["default"].set(t,"componentData",e)},addComponent(t,{component:e,index:o}){void 0!==o?t.componentData.splice(o,0,e):t.componentData.push(e)},deleteComponent(t,e){void 0===e&&(e=t.curComponentIndex),e===t.curComponentIndex&&(t.curComponentIndex=null,t.curComponent=null),/\d/.test(e)&&t.componentData.splice(e,1)},setGlobalCount(t){t.globalCount++},setPaletteCount(t){t.paletteCount++}},et={};var ot={STORAGE_PREFIX:"_ROY_DESIGNER_",MIN_SCALE:.25,MAX_SCALE:2};const{STORAGE_PREFIX:nt}=ot;var it={namespaced:!0,state:()=>({isNightMode:!1}),mutations:{setIsNightMode(t,e){t.isNightMode=e.isNightMode}},actions:{toggleNightMode({commit:t},e){window.localStorage.setItem(`${nt}NIGHT_MODE`,JSON.stringify(e)),document.getElementById("roy-print-template-designer").setAttribute("theme",e?"dark":"day"),t("setIsNightMode",{isNightMode:e})},async initNightMode({dispatch:t}){const e=window.localStorage.getItem(`${nt}NIGHT_MODE`);null!==e&&await t("toggleNightMode",JSON.parse(e))}}},rt=o(96389);const{MIN_SCALE:st,MAX_SCALE:at}=ot;var lt={namespaced:!0,state:()=>({scale:5,rectWidth:210,rectHeight:297,needReDrawRuler:0,showRuler:!0}),mutations:{setScale(t,e){let o=new rt.Z(e.scale);t.scale=new rt.Z(o).times(new rt.Z(5)).toNumber()},setBiggerScale(t){let e=new rt.Z(t.scale),o=e.div(new rt.Z(5)),n=new rt.Z(.1),i=o.plus(n).toNumber(),r=i>at?at:i;t.scale=new rt.Z(r).times(new rt.Z(5)).toNumber()},setSmallerScale(t){let e=new rt.Z(t.scale),o=e.div(new rt.Z(5)),n=new rt.Z(.1),i=o.minus(n).toNumber(),r=i<st?st:i;t.scale=new rt.Z(r).times(new rt.Z(5)).toNumber()},setReDrawRuler(t){t.needReDrawRuler+=1},setRect(t,e){t.rectWidth=e.w,t.rectHeight=e.h},rotateRect(t){const e=t.rectHeight;t.rectHeight=Number(t.rectWidth),t.rectWidth=Number(e)},toggleRuler(t){t.showRuler=!t.showRuler}},actions:{setBiggerScale({commit:t}){t("setBiggerScale")},setSmallerScale({commit:t}){t("setSmallerScale")},setScale({commit:t},e){t("setScale",{scale:e})},reDrawRuler({commit:t}){t("setReDrawRuler")},setRect({commit:t},e){t("setRect",e)},rotateRect({commit:t}){t("rotateRect")},toggleRuler({commit:t}){t("toggleRuler")}}},ct={namespaced:!0,state:K,mutations:tt,actions:et,getters:Q,modules:{nightMode:it,rulerThings:lt}};n["default"].use(i.ZP);var ut=new i.ZP.Store({modules:{printTemplateModule:ct}}),dt=function(){var t=this,e=t._self._c;return e("PtdDesigner",{ref:"designer",scopedSlots:t._u([{key:"roy-designer-header-slot",fn:function(){return[e("div",{staticClass:"head-slot"},[e("el-button",{attrs:{id:"royians-guide",icon:"ri-question-line",size:"mini"},on:{click:t.showUserGuide}},[t._v(" 界面指引 ")]),e("el-button",{attrs:{icon:"ri-printer-cloud-line",size:"mini"},on:{click:t.printPreview}},[t._v(" 打印预览 ")]),e("el-button",{attrs:{icon:"ri-file-pdf-line",size:"mini"},on:{click:t.exportPDF}},[t._v(" 导出PDF ")]),e("el-button",{attrs:{icon:"ri-braces-line",size:"mini"},on:{click:t.exportJSON}},[t._v(" 导出配置信息 ")]),t._l(t.headIconConfig,(function(t,o){return e("i",{key:o,staticClass:"roy-header-icon",class:t.icon,on:{click:t.event}})}))],2)]},proxy:!0},{key:"roy-designer-toolbar-slot",fn:function(){return t._l(t.toolbarSlotConfig,(function(t,o){return e("el-tooltip",{key:o,attrs:{content:t.name,"open-delay":600,"visible-arrow":!1,effect:"dark",placement:"bottom"}},[e("div",{staticClass:"toolbar-slot-item",on:{click:t.event}},[e("i",{class:t.icon})])])}))},proxy:!0}])})},ht=[],pt=o(15158),mt={useModalOverlay:!0,keyboardNavigation:!0,defaultStepOptions:{cancelIcon:{enabled:!0},scrollTo:{behavior:"smooth",block:"center"},modalOverlayOpeningPadding:8,modalOverlayOpeningRadius:4,buttons:[{action(){return this.back()},text:"上一步"},{action(){return this.next()},text:"下一步"}]}};const ft=(t={})=>{const e={...mt,...t};return new pt.Z.Tour(e)};var gt=ft,yt={name:"App",mounted(){x("欢迎使用ROYIANS的打印模板设计器，仅个人学习使用","info")},data(){return{toolbarSlotConfig:[{name:"从报表配置拉取表格",icon:"ri-table-line",event:()=>{x("从报表配置拉取表格(开发者自定义事件)")}}],headIconConfig:[{name:"Github",icon:"ri-github-fill",event:()=>{x("跳转到Github","info"),window.open("https://github.com/ROYIANS/print-template-designer","_blank")}}]}},methods:{showUserGuide(){const t=gt();t.addSteps([{attachTo:{element:document.querySelector("#royians-guide"),on:"auto"},title:"打印模板设计器界面指引",text:"欢迎使用！接下来介绍整个界面。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-header"),on:"auto"},title:"打印模板设计器界面指引",text:"这是标题栏，左侧显示”打印模板设计器”字样和当前模板名称，右侧是开发者自定义插槽和夜间模式切换按钮。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-aside"),on:"auto"},title:"打印模板设计器界面指引",text:"这是左侧面板，包含四个模块。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:this.$refs.designer.$el.querySelector(".roy-designer-main"),on:"bottom-start"},title:"打印模板设计器界面指引",text:"这是右侧面版，包含一个工具栏和一个主窗口。",buttons:[{action(){return this.next()},text:"下一步"}]},{attachTo:{element:document.querySelector("#royians-guide"),on:"auto"},title:"打印模板设计器界面指引",text:"本系统由ROYIANS设计，欢迎使用。",buttons:[{action(){return this.cancel()},text:"完成"}]}]),t.start()},exportJSON(){x("导出成功，请查看控制台！","success")},exportPDF(){},printPreview(){}}},xt=yt,vt=(0,c.Z)(xt,dt,ht,!1,null,null,null),Ct=vt.exports,bt=o(8499),wt=o.n(bt),Mt=o(72631);n["default"].use(Mt.ZP);const St=[],$t=new Mt.ZP({mode:"history",base:"/",routes:St});var Tt=$t,_t=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"roy-designer-container",attrs:{id:"roy-print-template-designer",theme:"day"}},[e("el-header",{staticClass:"roy-designer-header",attrs:{height:"40px"}},[e("div",{staticClass:"roy-designer-header__text"},[e("i",{staticClass:"ri-pen-nib-line"}),e("span",[t._v("打印模板设计器 | 新建模板")])]),e("div",{staticClass:"roy-designer__right"},[e("div",[t._t("roy-designer-header-slot")],2),e("div",{staticClass:"roy-night-mode"},[e("transition-group",{attrs:{name:"roy-fade",tag:"span"}},[t.isNightMode?e("i",{key:1,staticClass:"ri-haze-fill",on:{click:t.dayNightChange}}):e("i",{key:2,staticClass:"ri-moon-foggy-fill",on:{click:t.dayNightChange}})])],1)])]),e("el-container",{staticStyle:{height:"calc(100% - 40px)"}},[e("el-aside",{staticClass:"roy-designer-aside",attrs:{width:"auto"}},[e("DesignerAside",{attrs:{"show-right":t.defaultExpendAside},on:{"update:showRight":function(e){t.defaultExpendAside=e},"update:show-right":function(e){t.defaultExpendAside=e}}})],1),e("el-main",{staticClass:"roy-designer-main"},[e("DesignerMain",{attrs:{"show-right":t.defaultExpendAside},scopedSlots:t._u([{key:"roy-designer-toolbar-slot",fn:function(){return[t._t("roy-designer-toolbar-slot")]},proxy:!0}],null,!0)})],1)],1)],1)},kt=[],Rt={i8:"0.0.6"},Dt=function(){var t=this,e=t._self._c;return e("section",{staticClass:"roy-designer-aside__main",style:t.asideStyle},[e("el-menu",{staticClass:"roy-designer-aside__menu",attrs:{collapse:!0,"default-active":"0"},on:{select:t.onMenuSelect}},t._l(t.menuList,(function(o,n){return e("el-menu-item",{key:o.code,ref:"menuItem",refInFor:!0,staticStyle:{padding:"0","text-align":"center"},attrs:{index:`${n}`}},[e("div",{staticClass:"roy-designer-aside__menu__icon"},[e("i",{class:o.icon}),e("span",[t._v(t._s(o.name))])])])})),1),e("keep-alive",[e(t.curActiveComponent,{directives:[{name:"show",rawName:"v-show",value:t.showRight,expression:"showRight"}],key:t.curActiveComponentCode,tag:"component",staticClass:"roy-designer-aside__right_panel"})],1)],1)},Et=[],Nt=o(21917),At={name:"DesignerAside",mixins:[Nt.Z],data(){return{menuList:[{name:"组件",code:"component",icon:"ri-drag-drop-fill",component:()=>o.e(149).then(o.bind(o,99149))},{name:"结构",code:"toc",icon:"ri-node-tree",component:()=>o.e(848).then(o.bind(o,11848))},{name:"属性",code:"palette",icon:"ri-palette-line",component:()=>o.e(260).then(o.bind(o,88260))},{name:"数据源",code:"datasource",icon:"ri-database-2-line",component:()=>o.e(755).then(o.bind(o,15755))},{name:"全局",code:"setting",icon:"ri-sound-module-line",component:()=>o.e(158).then(o.bind(o,92158))}],curActiveComponent:null,curActiveComponentCode:""}},props:{showRight:{type:Boolean,default:!0}},computed:{...(0,i.rn)({paletteCount:t=>t.printTemplateModule.paletteCount,globalCount:t=>t.printTemplateModule.globalCount}),asideStyle(){return this.showRight?"width: 300px":"width: 65px"}},methods:{onMenuSelect(t){this.curActiveComponentCode===this.menuList[t].code?this.$emit("update:showRight",!this.showRight):this.$emit("update:showRight",!0),this.curActiveComponent=this.menuList[t].component,this.curActiveComponentCode=this.menuList[t].code},clickPaletteMenu(){this.$refs.menuItem.forEach((t=>{"palette"===t.$vnode.key&&"palette"!==this.curActiveComponentCode&&t.$el.click()}))},clickGlobalMenu(){this.$refs.menuItem.forEach((t=>{"setting"===t.$vnode.key&&"setting"!==this.curActiveComponentCode&&t.$el.click()}))}},mounted(){this.curActiveComponent=this.menuList[0].component,this.curActiveComponentCode=this.menuList[0].code},watch:{paletteCount(){this.clickPaletteMenu()},globalCount(){this.clickGlobalMenu()}}},Lt=At,Pt=(0,c.Z)(Lt,Dt,Et,!1,null,"4f101a0a",null),It=Pt.exports,Ot=function(){var t=this,e=t._self._c;return e("section",{staticClass:"height-all"},[e("ToolBar",{scopedSlots:t._u([{key:"roy-designer-toolbar-slot",fn:function(){return[t._t("roy-designer-toolbar-slot")]},proxy:!0}],null,!0)}),e("div",{on:{dragover:t.handleDragOver,drop:t.handleDrop,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor",{attrs:{"show-right":t.showRight}})],1)],1)},Bt=[],Zt=function(){var t=this,e=t._self._c;return e("el-header",{staticClass:"roy-designer-main__toolbar",attrs:{height:"45px"}},[e("section",{staticClass:"roy-designer-main__toolbar_left"},t._l(t.toolbarLeftConfig,(function(t,o){return e("el-tooltip",{key:o,attrs:{content:t.name,"open-delay":600,"visible-arrow":!1,effect:"dark",placement:"bottom"}},[e("div",{staticClass:"roy-designer-main__toolbar__item",class:t.disabled?"roy-designer-main__toolbar__item--disabled":"",on:{click:t.event}},[e("i",{class:t.icon})])])})),1),e("section",[t._t("roy-designer-toolbar-slot")],2),e("section",{staticClass:"roy-designer-main__toolbar_right"},[e("div",{staticClass:"roy-designer-main__toolbar__setting"},[e("span",[t._v(t._s(t.rectWidth)+"/"+t._s(t.rectHeight))])]),e("div",{staticClass:"roy-designer-main__toolbar__zoom"},[e("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.smallerScale.apply(null,arguments)}}},[e("i",{staticClass:"ri-zoom-out-line"})]),e("span",[t._v(t._s(t.scale100)+"%")]),e("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.biggerScale.apply(null,arguments)}}},[e("i",{staticClass:"ri-zoom-in-line"})])])])])},jt=[],Ht={name:"ToolBar",mixins:[Nt.Z],components:{},props:{},data(){return{}},computed:{...(0,i.rn)({scale:t=>t.printTemplateModule.rulerThings.scale,rectWidth:t=>t.printTemplateModule.rulerThings.rectWidth,rectHeight:t=>t.printTemplateModule.rulerThings.rectHeight,curComponent:t=>t.printTemplateModule.curComponent,areaData:t=>t.printTemplateModule.areaData}),scale100(){let t=new rt.Z(this.scale).div(new rt.Z(5)),e=new rt.Z(100);return t.mul(e).toNumber()},toolbarLeftConfig(){return[{name:"撤销",icon:"ri-arrow-go-back-fill",event:()=>{this.$store.commit("printTemplateModule/undo")}},{name:"恢复",icon:"ri-arrow-go-forward-fill",event:()=>{this.$store.commit("printTemplateModule/redo")}},{name:"显示/隐藏标尺",icon:"ri-ruler-2-line",event:()=>{this.toggleRuler()}},{name:this.curComponent&&this.curComponent.isLock?"解锁":"锁定",icon:this.curComponent&&this.curComponent.isLock?"ri-lock-unlock-line":"ri-lock-2-line",disabled:!this.curComponent,event:()=>{this.curComponent.isLock?this.$store.commit("printTemplateModule/unlock"):this.$store.commit("printTemplateModule/lock")}},{name:"切换纸张方向",icon:"iconfont icon-zhizhangfangxiang bold",event:()=>{this.rotatePage()}}]}},methods:{...(0,i.nv)({setBiggerScale:"printTemplateModule/rulerThings/setBiggerScale",setSmallerScale:"printTemplateModule/rulerThings/setSmallerScale",reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setRect:"printTemplateModule/rulerThings/setRect",rotateRect:"printTemplateModule/rulerThings/rotateRect",toggleRuler:"printTemplateModule/rulerThings/toggleRuler"}),smallerScale(){this.setSmallerScale(),this.reDrawRuler()},biggerScale(){this.setBiggerScale(),this.reDrawRuler()},rotatePage(){this.rotateRect(),this.reDrawRuler()},initMounted(){}},created(){},mounted(){this.initMounted()},watch:{}},Wt=Ht,zt=(0,c.Z)(Wt,Zt,jt,!1,null,"39843185",null),Vt=zt.exports,Ft=function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-designer-main__page",style:t.panelWidth},[e("SketchRuler",{directives:[{name:"show",rawName:"v-show",value:t.showRuler,expression:"showRuler"}],ref:"sketchRuler",attrs:{cornerActive:!1,height:t.rulerHeight,horLineArr:t.lines.h,lang:t.lang,palette:t.palette,scale:t.realScale,shadow:t.shadow,startX:t.startX,startY:t.startY,thick:t.thick,verLineArr:t.lines.v,width:t.rulerWidth},on:{handleLine:t.handleLine,onCornerClick:t.handleCornerClick}}),e("div",{ref:"screensRef",attrs:{id:"screens"},on:{scroll:t.handleScroll,wheel:t.handleWheel}},[e("div",{ref:"containerRef",staticClass:"screen-container"},[e("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:"contextmenu",expression:"'contextmenu'"}],style:t.canvasStyle,attrs:{id:"designer-page"},on:{contextmenu:t.handleContextMenu,mousedown:t.handleMouseDown}},[t._l(t.componentData,(function(o,n){return e("ComponentAdjuster",{key:o.id,class:{lock:o.isLock},style:t.getShapeStyle(o.style),attrs:{active:o.id===(t.curComponent||{}).id,"default-style":o.style,element:o,index:n,scale:t.scale}},[e(o.component,{tag:"component",attrs:{id:"roy-component-"+o.id,element:o,"prop-value":o.propValue}})],1)})),e("Area",{directives:[{name:"show",rawName:"v-show",value:t.isShowArea,expression:"isShowArea"}],attrs:{height:t.height,start:t.start,width:t.width}}),e("EditorLine")],2)])]),e("Context",{ref:"contextmenu",attrs:{theme:t.contextTheme}},t._l(t.contextMenu,(function(o){return e("ContextItem",{key:o.code,class:`roy-context--${o.status}`,on:{click:o.event}},[e("i",{class:o.icon}),e("span",[t._v(t._s(o.label))])])})),1),e("EditorCoordinate")],1)},Yt=[],Xt=o(50942),Gt={inserted(t,e,o){const n=o.context.$refs[e.arg]||o.context.$refs[e.value],i="[object Array]"===Object.prototype.toString.call(n)?n[0]:n;i.addRef({el:t,vnode:o}),i.$contextmenuId=t.id||i._uid}},qt=function(){var t=this,e=t._self._c;return e("ul",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],ref:"contextmenu",class:t.contextmenuCls,style:t.style},[t._t("default")],2)},Ut=[],Jt={name:"RoyContext",provide(){return{$$contextmenu:this}},props:{eventType:{type:String,default:"contextmenu"},theme:{type:String,default:"default"},autoPlacement:{type:Boolean,default:!0},disabled:Boolean},data(){return{visible:!1,references:[],style:{top:0,left:0}}},computed:{clickOutsideHandler(){return this.visible?this.hide:()=>{}},isClick(){return"click"===this.eventType},contextmenuCls(){return["roy-context",`roy-context--${this.theme}`]}},watch:{visible(t){t?(this.$emit("show",this),document.body.addEventListener("click",this.handleBodyClick)):(this.$emit("hide",this),document.body.removeEventListener("click",this.handleBodyClick))}},mounted(){document.body.appendChild(this.$el),window.$$VContextmenu?window.$$VContextmenu[this.$contextmenuId]=this:window.$$VContextmenu={[this.$contextmenuId]:this}},beforeDestroy(){document.body.removeChild(this.$el),delete window.$$VContextmenu[this.$contextmenuId],this.references.forEach((t=>{t.el.removeEventListener(this.eventType,this.handleReferenceContextmenu)})),document.body.removeEventListener("click",this.handleBodyClick)},methods:{addRef(t){this.references.push(t),t.el.addEventListener(this.eventType,this.handleReferenceContextmenu)},handleReferenceContextmenu(t){if(t.preventDefault(),this.disabled)return;const e=this.references.find((e=>e.el.contains(t.target)));this.$emit("contextmenu",e?e.vnode:null);const o=t.pageX,n=t.pageY;this.show(),this.$nextTick((()=>{const t={top:n,left:o};if(this.autoPlacement){const e=this.$refs.contextmenu.clientWidth,i=this.$refs.contextmenu.clientHeight;i+n>=window.innerHeight&&(t.top-=i),e+o>=window.innerWidth&&(t.left-=e)}this.style={top:`${t.top}px`,left:`${t.left}px`}}))},handleBodyClick(t){const e=this.$el.contains(t.target)||this.isClick&&this.references.some((e=>e.el.contains(t.target)));e||(this.visible=!1)},show(t){Object.keys(window.$$VContextmenu).forEach((t=>{t!==this.$contextmenuId&&window.$$VContextmenu[t].hide()})),t&&(this.style={top:`${t.top}px`,left:`${t.left}px`}),this.visible=!0},hide(){this.visible=!1},hideAll(){Object.keys(window.$$VContextmenu).forEach((t=>{window.$$VContextmenu[t].hide()}))}}},Kt=Jt,Qt=(0,c.Z)(Kt,qt,Ut,!1,null,null,null),te=Qt.exports,ee=function(){var t=this,e=t._self._c;return t.divider?e("li",{staticClass:"roy-context-divider"}):e("li",{class:t.classname,on:{click:t.handleClick,mouseenter:t.handleMouseenter,mouseleave:t.handleMouseleave}},[t._t("default")],2)},oe=[],ne={name:"ContextItem",inject:["$$contextmenu"],props:{divider:Boolean,disabled:Boolean,autoHide:{type:Boolean,default:!0}},data(){return{hover:!1}},computed:{classname(){return{"roy-context-item":!this.divider,"roy-context-item--hover":this.hover,"roy-context-item--disabled":this.disabled}}},methods:{handleMouseenter(t){this.disabled||(this.hover=!0,this.$emit("mouseenter",this,t))},handleMouseleave(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))},handleClick(t){this.disabled||(this.$emit("click",this,t),this.autoHide&&this.$$contextmenu.hide())}}},ie=ne,re=(0,c.Z)(ie,ee,oe,!1,null,null,null),se=re.exports,ae=function(){var t=this,e=t._self._c;return e("li",{staticClass:"v-contextmenu-group"},[e("ul",{staticClass:"v-contextmenu-group__menus",style:t.menusStyle},[t._t("default")],2)])},le=[],ce={name:"ContextGroup",props:{maxWidth:{type:[Number,String],default:void 0}},computed:{menusStyle(){return this.maxWidth?{"max-width":"number"===typeof this.maxWidth?`${this.maxWidth}px`:this.maxWidth,"overflow-x":"auto"}:null}}},ue=ce,de=(0,c.Z)(ue,ae,le,!1,null,null,null),he=(de.exports,function(){var t=this,e=t._self._c;return e("li",{class:t.classname,on:{mouseenter:t.handleMouseenter,mouseleave:t.handleMouseleave}},[e("span",{staticClass:"v-contextmenu-submenu__title"},[t._t("title",(function(){return[t._v(t._s(t.title))]})),e("span",{staticClass:"v-contextmenu-iconfont v-contextmenu-submenu__icon"})],2),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.hover,expression:"hover"}],ref:"submenu",class:t.submenuCls},[t._t("default")],2)])}),pe=[],me={name:"VContextmenuSubmenu",props:{title:{type:String,default:""},disabled:Boolean},data(){return{hover:!1,submenuPlacement:[]}},computed:{classname(){return{"v-contextmenu-item":!0,"v-contextmenu-submenu":!0,"v-contextmenu-item--hover":this.hover,"v-contextmenu-item--disabled":this.disabled}},submenuCls(){return["v-contextmenu",...this.submenuPlacement]}},methods:{handleMouseenter(t){if(this.disabled)return;const{target:e}=t,o=e.getBoundingClientRect();this.hover=!0,this.$emit("mouseenter",this,t),this.$nextTick((()=>{const t=this.$refs.submenu.clientWidth,e=this.$refs.submenu.clientHeight,n=[];o.right+t>=window.innerWidth?n.push("left"):n.push("right"),o.bottom+e>=window.innerHeight?n.push("bottom"):n.push("top"),this.submenuPlacement=n}))},handleMouseleave(t){this.disabled||(this.hover=!1,this.$emit("mouseleave",this,t))}}},fe=me,ge=(0,c.Z)(fe,he,pe,!1,null,null,null),ye=(ge.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-component-adjuster",style:t.adjusterStyle,on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"ri-checkbox-blank-circle-line roy-component-adjuster__rotate",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"ri-lock-fill roy-component-adjuster__lock"}),t._l(t.isActive?t.pointList:[],(function(o){return e("div",{key:o,class:`roy-component-adjuster__shape-point--${o}`,style:t.getPointStyle(o),on:{mousedown:function(e){return t.handleMouseDownOnPoint(o,e)}}})})),t._t("default")],2)}),xe=[];const ve=30,Ce=30,be={lt:we,t:Te,rt:Me,r:_e,rb:Se,b:ke,lb:$e,l:Re};function we(t,e,o,n,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=l.x-a.x,u=l.y-a.y;if(n){c/u>o?(a.x+=Math.abs(c-u*o),c=u*o):(a.y+=Math.abs(u-c/o),u=c/o);const e=R(a,s,t.rotate);s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=l.x-a.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ve),t.height=Math.max(Math.round(u),Ce),t.left=Math.round(a.x),t.top=Math.round(a.y))}function Me(t,e,o,n,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=a.x-l.x,u=l.y-a.y;if(n){c/u>o?(a.x-=Math.abs(c-u*o),c=u*o):(a.y+=Math.abs(u-c/o),u=c/o);const e=R(a,s,t.rotate);s=D(e,r),a=R(e,s,-t.rotate),l=R(r,s,-t.rotate),c=a.x-l.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ve),t.height=Math.max(Math.round(u),Ce),t.left=Math.round(l.x),t.top=Math.round(a.y))}function Se(t,e,o,n,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=l.x-a.x,u=l.y-a.y;if(n){c/u>o?(l.x-=Math.abs(c-u*o),c=u*o):(l.y-=Math.abs(u-c/o),u=c/o);const e=R(l,s,t.rotate);s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=l.x-a.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ve),t.height=Math.max(Math.round(u),Ce),t.left=Math.round(a.x),t.top=Math.round(a.y))}function $e(t,e,o,n,i){const{symmetricPoint:r}=i;let s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=a.x-l.x,u=l.y-a.y;if(n){c/u>o?(l.x+=Math.abs(c-u*o),c=u*o):(l.y-=Math.abs(u-c/o),u=c/o);const e=R(l,s,t.rotate);s=D(e,r),a=R(r,s,-t.rotate),l=R(e,s,-t.rotate),c=a.x-l.x,u=l.y-a.y}c>0&&u>0&&(t.width=Math.max(Math.round(c),ve),t.height=Math.max(Math.round(u),Ce),t.left=Math.round(l.x),t.top=Math.round(a.y))}function Te(t,e,o,n,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:s.x,y:a.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.width;n&&(d=c*o),t.width=Math.max(d,ve),t.height=Math.max(Math.round(c),Ce),t.top=Math.round(u.y-c/2),t.left=Math.round(u.x-t.width/2)}function _e(t,e,o,n,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:a.x,y:s.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.height;n&&(d=c/o),t.height=Math.max(d,Ce),t.width=Math.max(Math.round(c),ve),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-c/2)}function ke(t,e,o,n,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:s.x,y:a.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.width;n&&(d=c*o),t.width=Math.max(d,ve),t.height=Math.max(Math.round(c),Ce),t.top=Math.round(u.y-c/2),t.left=Math.round(u.x-t.width/2)}function Re(t,e,o,n,i){const{symmetricPoint:r,curPoint:s}=i,a=R(e,s,-t.rotate),l=R({x:a.x,y:s.y},s,t.rotate),c=Math.sqrt((l.x-r.x)**2+(l.y-r.y)**2),u={x:l.x-(l.x-r.x)/2,y:l.y+(r.y-l.y)/2};let d=t.height;n&&(d=c/o),t.height=Math.max(d,Ce),t.width=Math.max(Math.round(c),ve),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-c/2)}function De(t,e,o,n,i,r){be[t](e,o,n,i,r)}var Ee={name:"ComponentAdjuster",mixins:[Nt.Z],components:{},props:{active:{type:Boolean,default:!1},element:{required:!0,type:Object,default:()=>{}},defaultStyle:{required:!0,type:Object,default:()=>{}},index:{required:!0,type:[Number,String],default:0},scale:{required:!0,type:[Number,String],default:1}},data(){return{cursors:{},initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}]}},computed:{...(0,i.rn)({editor:t=>t.printTemplateModule.editor,curComponent:t=>t.printTemplateModule.curComponent}),pointList(){return"RoyLine"===this.element.component?["r","l"]:["lt","t","rt","r","rb","b","lb","l"]},isActive(){return this.active&&!this.element.isLock},adjusterStyle(){return{border:this.isActive?"0.5px dashed var(--roy-text-color-secondary)":void 0}}},methods:{initMounted(){this.cursors=this.getCursor()},getPointStyle(t){const{width:e,height:o}=this.defaultStyle,n=/t/.test(t),i=/b/.test(t),r=/l/.test(t),s=/r/.test(t);let a=0,l=0;return 2===t.length?(a=r?0:e,l=n?0:o):((n||i)&&(a=e/2,l=n?0:o),(r||s)&&(a=r?0:e,l=Math.floor(o/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${a}px`,top:`${l}px`,cursor:this.cursors[t]}},getCursor(){const t=A(this.curComponent?.style?.rotate||0),e={};let o=-1;return this.pointList.forEach((n=>{const i=A(this.initialAngle[n]+t),r=this.angleToCursor.length;while(1){o=(o+1)%r;const t=this.angleToCursor[o];if(i<23||i>=338)return void(e[n]="nw-resize");if(t.start<=i&&i<t.end)return void(e[n]=t.cursor+"-resize")}})),e},handleRotate(t){this.$store.commit("printTemplateModule/setClickComponentStatus",!0),t.preventDefault(),t.stopPropagation();const e={...this.defaultStyle},o=t.clientY,n=t.clientX,i=e.rotate,r=this.$el.getBoundingClientRect(),s=r.left+r.width/2,a=r.top+r.height/2,l=Math.atan2(o-a,n-s)/(Math.PI/180);let c=!1;const u=t=>{c=!0;const o=t.clientX,n=t.clientY,r=Math.atan2(n-a,o-s)/(Math.PI/180);e.rotate=i+r-l,this.$store.commit("printTemplateModule/setShapeStyle",e)},d=()=>{c&&this.$store.commit("printTemplateModule/recordSnapshot"),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),this.cursors=this.getCursor()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)},handleMouseDownOnPoint(t,e){this.$store.commit("printTemplateModule/setInEditorStatus",!0),this.$store.commit("printTemplateModule/setClickComponentStatus",!0),e.stopPropagation(),e.preventDefault();const o={...this.defaultStyle},n=o.width/o.height,i={x:o.left+o.width/2,y:o.top+o.height/2},r=this.editor.getBoundingClientRect(),s=e.target.getBoundingClientRect(),a={x:Math.round(s.left/this.scale-r.left/this.scale+e.target.offsetWidth/this.scale/2),y:Math.round(s.top/this.scale-r.top/this.scale+e.target.offsetHeight/this.scale/2)},l={x:i.x-(a.x-i.x),y:i.y-(a.y-i.y)};let c=!1,u=!0;const d=this.isNeedLockProportion(),h=e=>{if(u)return void(u=!1);c=!0;const s={x:(e.clientX-Math.round(r.left))/this.scale,y:(e.clientY-Math.round(r.top))/this.scale};De(t,o,s,n,d,{center:i,curPoint:a,symmetricPoint:l}),this.$store.commit("printTemplateModule/setShapeStyle",o)},p=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",p),c&&this.$store.commit("printTemplateModule/recordSnapshot")};document.addEventListener("mousemove",h),document.addEventListener("mouseup",p)},isNeedLockProportion(){if("RoyGroup"!==this.element.component)return!1;const t=[0,90,180,360];for(const e of this.element.propValue)if(!t.includes(A(parseInt(e.style.rotate))))return!0;return!1},selectCurComponent(t){t.stopPropagation(),t.preventDefault()},handleMouseDownOnShape(t){if(this.$nextTick((()=>M.$emit("componentClick"))),this.$store.commit("printTemplateModule/setInEditorStatus",!0),this.$store.commit("printTemplateModule/setClickComponentStatus",!0),_(this.element.component)&&t.preventDefault(),t.stopPropagation(),this.$store.commit("printTemplateModule/setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const e={...this.defaultStyle},o=t.clientY,n=t.clientX,i=Number(e.top),r=Number(e.left);let s=!1;const a=t=>{s=!0;const a=t.clientX,l=t.clientY,c=this.editor;e.top=Math.min(Math.max(0,(l-o)/this.scale+i),c.offsetHeight-e.height),e.left=Math.min(Math.max(0,(a-n)/this.scale+r),c.offsetWidth-e.width),this.$store.commit("printTemplateModule/setShapeStyle",e),this.$nextTick((()=>{M.$emit("move",l-o>0,a-n>0,a,l)}))},l=()=>{s&&this.$store.commit("printTemplateModule/recordSnapshot"),M.$emit("unmove"),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)}},created(){},mounted(){this.initMounted()},watch:{}},Ne=Ee,Ae=(0,c.Z)(Ne,ye,xe,!1,null,null,null),Le=Ae.exports,Pe=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"},on:{dblclick:t.onDblClick}},[e("RoyModal",{attrs:{show:t.showEditor},on:{"update:show":function(e){t.showEditor=e}}},[e("div",{staticClass:"roy-wang-editor",style:`transform:rotate(${-t.style.rotate}deg)`,on:{mousedown:t.handleMouseDown}},[e("Toolbar",{staticStyle:{"border-bottom":"1px solid #ccc"},attrs:{editor:t.wangEditor,defaultConfig:t.toolbarConfig}}),e("Editor",{staticStyle:{height:"300px"},attrs:{defaultConfig:t.editorConfig,mode:t.mode},on:{onCreated:t.onCreated,onBlur:t.onBlur},model:{value:t.html,callback:function(e){t.html=e},expression:"html"}})],1)]),e("StyledText",t._b({domProps:{innerHTML:t._s(t.propValue)}},"StyledText",t.style,!1))],1)},Ie=[],Oe=o(63774);const Be={color:{type:String,default:"#212121"},background:{type:String,default:"#FFFFFF"},border:{type:String,default:"none"},borderRadius:{type:String,default:"inherit"},padding:{type:String,default:"0 0 0 0"},margin:{type:String,default:"0 0 0 0"},fontSize:{type:Number,default:12},zIndex:{type:Number,default:1},fontFamily:{type:String,default:"default"},lineHeight:{type:String,default:"1"},letterSpacing:{type:String,default:"0"},justifyContent:{type:String,default:"flex-start"},alignItems:{type:String,default:"flex-start"},borderWidth:{type:Number,default:0},borderColor:{type:String,default:"#212121"},borderType:{type:String,default:"solid"}},Ze=Object.assign(Be,{}),je=(0,Oe.ZP)("div",Ze)`
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
  color: ${t=>t.color};
  background: ${t=>t.background};
  border: ${t=>t.border};
  border-radius: ${t=>t.borderRadius};
  padding: ${t=>t.padding};
  margin: ${t=>t.margin};
  font-size: ${t=>`${t.fontSize}pt`};
  font-family: ${t=>"default"===t.fontFamily?"LXGW New Clear Gothic Book, Helvetica Neue, Helvetica, Arial, PingFang SC, Microsoft YaHei, WenQuanYi Micro Hei, sans-serif":`${t.fontFamily}`};
  z-index: ${t=>t.zIndex};
  line-height: ${t=>t.lineHeight};
  letter-spacing: ${t=>`${t.letterSpacing}px`};
  border: ${t=>`${t.borderWidth}px ${t.borderType} ${t.borderColor}`};
`,He=(0,Oe.ZP)("div",Ze)`
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
  display: flex;
  justify-content: ${t=>t.justifyContent};
  align-items: ${t=>t.alignItems};
  color: ${t=>t.color};
  background: ${t=>t.background};
  border: ${t=>t.border};
  border-radius: ${t=>t.borderRadius};
  padding: ${t=>t.padding};
  margin: ${t=>t.margin};
  font-size: ${t=>`${t.fontSize}pt`};
  font-family: ${t=>"default"===t.fontFamily?"LXGW New Clear Gothic Book, Helvetica Neue, Helvetica, Arial, PingFang SC, Microsoft YaHei, WenQuanYi Micro Hei, sans-serif":`${t.fontFamily}`};
  z-index: ${t=>t.zIndex};
  line-height: ${t=>t.lineHeight};
  letter-spacing: ${t=>`${t.letterSpacing}px`};
  border: ${t=>`${t.borderWidth}px ${t.borderType} ${t.borderColor}`};
`;var We=function(){var t=this,e=t._self._c;return e("div",{ref:"modal",staticClass:"roy-modal-container",class:t.show?"roy-modal-sketch":"roy-modal-out"},[e("div",{staticClass:"roy-modal-modal-background"},[e("div",{staticClass:"roy-modal-modal"},[e("svg",{staticClass:"roy-modal-modal-svg",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",preserveAspectRatio:"none"}},[e("rect",{attrs:{x:"0",y:"0",fill:"none",width:"100%",height:"100%",rx:"3",ry:"3"}})]),t._t("default"),e("div",{staticClass:"roy-modal-close",on:{click:t.close}},[e("i",{staticClass:"ri-close-circle-fill"})])],2)])])},ze=[];const Ve={name:"RoyModal",components:{},props:{appendToBody:{type:Boolean,default:!0},show:{type:Boolean,default:!1},width:{type:String,default:"50%"},height:{type:String,default:"50%"}},data(){return{}},methods:{initMounted(){this.show&&this.appendToBody&&document.body.appendChild(this.$el)},close(){this.$emit("close"),this.$emit("update:show",!1)}},created(){},mounted(){this.initMounted()},destroyed(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},watch:{show(t){t&&this.appendToBody&&document.body.appendChild(this.$el)}}},Fe=()=>{(0,n.useCssVars)(((t,e)=>({e9bc24c6:t.width,"816667a0":t.height})))},Ye=Ve.setup;Ve.setup=Ye?(t,e)=>(Fe(),Ye(t,e)):Fe;var Xe=Ve,Ge=Xe,qe=(0,c.Z)(Ge,We,ze,!1,null,null,null),Ue=qe.exports,Je=o(6126),Ke={name:"RoyText",props:{element:{type:Object,default:()=>{}},propValue:{type:String,default:""}},components:{Editor:Je.M,Toolbar:Je.o,StyledText:je,RoyModal:Ue},computed:{...(0,i.rn)({curComponent:t=>t.printTemplateModule.curComponent}),style(){return this.element.style||{}}},data(){return{wangEditor:null,showEditor:!1,html:this.propValue,toolbarConfig:{toolbarKeys:["bold","underline","italic","through","sub","sup","clearStyle","color","bgColor","fontSize","fontFamily","indent","delIndent","justifyLeft","justifyRight","justifyCenter","justifyJustify","lineHeight","headerSelect","header1","header2","header3","header4","header5","undo","redo","enter","bulletedList","numberedList","fullScreen"]},editorConfig:{placeholder:"请输入内容...",scroll:!0,autoFocus:!0,MENU_CONF:{fontFamily:{fontFamilyList:["黑体","楷体","仿宋","Arial","Tahoma","Verdana"]},fontSize:{fontSizeList:["10pt","12pt","13pt","14pt","15pt","16pt","19pt","22pt","24pt","29pt","32pt","40pt","48pt"]}}},mode:"simple"}},methods:{onCreated(t){this.wangEditor=Object.seal(t)},onBlur(){this.$store.commit("printTemplateModule/setPropValue",{id:this.element.id,propValue:this.html})},onDblClick(){this.showEditor=!0},handleMouseDown(t){t.stopPropagation()}},created(){},watch:{},beforeDestroy(){const t=this.wangEditor;null!=t&&t.destroy()}},Qe=Ke,to=(0,c.Z)(Qe,Pe,Ie,!1,null,null,null),eo=to.exports,oo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"RoySimpleText",staticStyle:{width:"100%",height:"100%"},on:{dblclick:t.setEdit}},[e("StyledSimpleText",t._b({ref:"editArea",staticClass:"edit-area",class:{"can-edit":t.canEdit},attrs:{contenteditable:t.canEdit,tabindex:"0"},domProps:{innerHTML:t._s(t.propValue)},on:{paste:t.clearStyle,mousedown:t.handleMousedown,blur:t.handleBlur}},"StyledSimpleText",t.style,!1))],1)},no=[],io={name:"RoySimpleText",mixins:[Nt.Z],components:{StyledSimpleText:He},props:{element:{type:Object,default:()=>{}},propValue:{type:String,default:""}},computed:{...(0,i.rn)({curComponent:t=>t.printTemplateModule.curComponent}),style(){return this.element.style||{}},mayEdit(){return this.curComponent?.id===this.element?.id}},data(){return{canEdit:!1}},methods:{initMounted(){},setEdit(){this.element.isLock||(this.canEdit=!0,this.selectText(this.$refs.editArea.$el),this.$refs.editArea.$el.focus())},selectText(t){const e=window.getSelection(),o=document.createRange();o.selectNodeContents(t),e.removeAllRanges(),e.addRange(o)},handleBlur(){this.canEdit=!1},handleMousedown(t){this.canEdit&&t.stopPropagation()},handleMouseDown(t){this.canEdit&&t.stopPropagation()},clearStyle(t){t.preventDefault();const e=t.clipboardData,o=e.getData("text/plain")||"";""!==o&&document.execCommand("insertText",!1,o),this.$emit("input",this.element,t.target.innerHTML)}},created(){},mounted(){this.initMounted()},watch:{mayEdit(t){t||(this.canEdit=!1)},canEdit(t){t||this.$store.commit("printTemplateModule/setPropValue",{id:this.element.id,propValue:this.$refs.editArea.$el.innerHTML})}}},ro=io,so=(0,c.Z)(ro,oo,no,!1,null,null,null),ao=so.exports,lo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-group"},[e("div",t._l(t.propValue,(function(t){return e(t.component,{key:t.id,tag:"component",staticClass:"roy-group-component",style:t.groupStyle,attrs:{id:"roy-component-"+t.id,"prop-value":t.propValue,element:t,request:t.request}})})),1)])},co=[],uo={name:"RoyGroup",mixins:[Nt.Z],components:{RoyText:eo},props:{propValue:{type:Array,default:()=>[]},element:{type:Object,default:()=>{}}},data(){return{}},methods:{initMounted(){}},created(){},mounted(){this.initMounted()},watch:{}},ho=uo,po=(0,c.Z)(ho,lo,co,!1,null,"5b335ab7",null),mo=po.exports,fo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-designer-area",style:{left:t.start.x+"px",top:t.start.y+"px",width:t.width+"px",height:t.height+"px"}})},go=[],yo={name:"RoyArea",props:{start:{type:Object,default:()=>{}},width:{type:Number,default:0},height:{type:Number,default:0}}},xo=yo,vo=(0,c.Z)(xo,fo,go,!1,null,"6b428fc4",null),Co=vo.exports,bo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"roy-mark-line"},t._l(t.lines,(function(o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.lineStatus[o]||!1,expression:"lineStatus[line] || false"}],key:o,ref:o,refInFor:!0,staticClass:"roy-mark-line__line",class:o.includes("x")?"roy-mark-line--xline":"roy-mark-line--yline"})})),0)},wo=[],Mo={name:"EditorLine",data(){return{lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}}},computed:{...(0,i.rn)({componentData:t=>t.printTemplateModule.componentData,curComponent:t=>t.printTemplateModule.curComponent})},mounted(){M.$on("move",((t,e)=>{this.showLine(t,e)})),M.$on("unmove",(()=>{this.hideLine()}))},methods:{hideLine(){Object.keys(this.lineStatus).forEach((t=>{this.lineStatus[t]=!1}))},showLine(t,e){const o=this.$refs,n=this.componentData||[],i=H(this.curComponent?.style||{}),r=i.width/2,s=i.height/2;this.hideLine(),n.forEach((n=>{if(n===this.curComponent)return;const a=H(n.style),{top:l,left:c,bottom:u,right:d}=a,h=a.width/2,p=a.height/2,m={top:[{isNearly:this.isNearly(i.top,l),lineNode:o.xt[0],line:"xt",dragShift:l,lineShift:l},{isNearly:this.isNearly(i.bottom,l),lineNode:o.xt[0],line:"xt",dragShift:l-i.height,lineShift:l},{isNearly:this.isNearly(i.top+s,l+p),lineNode:o.xc[0],line:"xc",dragShift:l+p-s,lineShift:l+p},{isNearly:this.isNearly(i.top,u),lineNode:o.xb[0],line:"xb",dragShift:u,lineShift:u},{isNearly:this.isNearly(i.bottom,u),lineNode:o.xb[0],line:"xb",dragShift:u-i.height,lineShift:u}],left:[{isNearly:this.isNearly(i.left,c),lineNode:o.yl[0],line:"yl",dragShift:c,lineShift:c},{isNearly:this.isNearly(i.right,c),lineNode:o.yl[0],line:"yl",dragShift:c-i.width,lineShift:c},{isNearly:this.isNearly(i.left+r,c+h),lineNode:o.yc[0],line:"yc",dragShift:c+h-r,lineShift:c+h},{isNearly:this.isNearly(i.left,d),lineNode:o.yr[0],line:"yr",dragShift:d,lineShift:d},{isNearly:this.isNearly(i.right,d),lineNode:o.yr[0],line:"yr",dragShift:d-i.width,lineShift:d}]},f=[],{rotate:g}=this.curComponent.style;Object.keys(m).forEach((t=>{m[t].forEach((e=>{e.isNearly&&(this.$store.commit("printTemplateModule/setShapeSingleStyle",{key:t,value:0!==g?this.translatecurComponentShift(t,e,i):e.dragShift}),e.lineNode.style[t]=`${e.lineShift}px`,f.push(e.line))}))})),f.length&&this.chooseTheTureLine(f,t,e)}))},translatecurComponentShift(t,e,o){const{width:n,height:i}=this.curComponent.style;return"top"===t?Math.round(e.dragShift-(i-o.height)/2):Math.round(e.dragShift-(n-o.width)/2)},chooseTheTureLine(t,e,o){o?t.includes("yr")?this.lineStatus.yr=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yl")&&(this.lineStatus.yl=!0):t.includes("yl")?this.lineStatus.yl=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yr")&&(this.lineStatus.yr=!0),e?t.includes("xb")?this.lineStatus.xb=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xt")&&(this.lineStatus.xt=!0):t.includes("xt")?this.lineStatus.xt=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xb")&&(this.lineStatus.xb=!0)},isNearly(t,e){return Math.abs(t-e)<=this.diff}}},So=Mo,$o=(0,c.Z)(So,bo,wo,!1,null,"68b20930",null),To=$o.exports,_o=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCoordinate,expression:"showCoordinate"}],staticClass:"roy-editor-coordinate",style:t.coordinateStyle},[t._v(" "+t._s(t.left)+","+t._s(t.top)+" ")])},ko=[],Ro={name:"EditorCoordinate",mixins:[Nt.Z],components:{},props:{},computed:{...(0,i.rn)({curComponent:t=>t.printTemplateModule.curComponent}),coordinateStyle(){return`left: ${this.x+10}px; top: ${this.y+10}px`}},data(){return{x:0,y:0,left:0,top:0,showCoordinate:!1}},methods:{initMounted(){M.$on("move",((t,e,o,n)=>{this.showCoordinate=!0,this.x=o,this.y=n,this.left=this.curComponent.style.left,this.top=this.curComponent.style.top})),M.$on("unmove",(()=>{this.showCoordinate=!1}))}},created(){},mounted(){this.initMounted()},watch:{}},Do=Ro,Eo=(0,c.Z)(Do,_o,ko,!1,null,null,null),No=Eo.exports;const{MIN_SCALE:Ao,MAX_SCALE:Lo}=ot;var Po={name:"RoyEditor",directives:{contextmenu:Gt},mixins:[Nt.Z],components:{EditorCoordinate:No,EditorLine:To,SketchRuler:Xt.Z,Context:te,ContextItem:se,ComponentAdjuster:Le,RoyText:eo,RoySimpleText:ao,RoyGroup:mo,Area:Co},props:{showRight:{type:Boolean,default:!0}},data(){return{rulerWidth:0,rulerHeight:0,startX:-19,startY:-25,lines:{h:[],v:[]},thick:20,lang:"zh-CN",isShowRuler:!0,isShowReferLine:!0,palette:{bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#4579e1",borderColor:"#DADADC",cornerActiveColor:"#4579e1"},editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1,svgFilterAttrs:["width","height","top","left","rotate"]}},computed:{...(0,i.rn)({realScale:t=>t.printTemplateModule.rulerThings.scale,rectWidth:t=>t.printTemplateModule.rulerThings.rectWidth,rectHeight:t=>t.printTemplateModule.rulerThings.rectHeight,needReDrawRuler:t=>t.printTemplateModule.rulerThings.needReDrawRuler,showRuler:t=>t.printTemplateModule.rulerThings.showRuler,componentData:t=>t.printTemplateModule.componentData,curComponent:t=>t.printTemplateModule.curComponent,editor:t=>t.printTemplateModule.editor}),contextTheme(){return this.isNightMode?"dark":"default"},contextMenu(){return this.curComponent?this.curComponent.isLock?[{code:"unlock",icon:"ri-lock-unlock-line",label:"解锁",status:"default",event:()=>{this.$store.commit("printTemplateModule/unlock")}}]:[{code:"setting",icon:"ri-list-settings-line",label:"属性",status:"default",event:()=>{this.$store.commit("printTemplateModule/setPaletteCount")}},{code:"copy",icon:"ri-file-copy-line",label:"复制",status:"default",event:()=>{this.$store.commit("printTemplateModule/copy")}},{code:"cut",icon:"ri-scissors-cut-line",label:"剪切",status:"default",event:()=>{this.$store.commit("printTemplateModule/cut")}},{code:"del",icon:"ri-delete-bin-line",label:"删除",status:"danger",event:()=>{this.$store.commit("printTemplateModule/deleteComponent"),this.$store.commit("printTemplateModule/recordSnapshot")}},{code:"lock",icon:"ri-lock-line",label:"锁定",status:"default",event:()=>{this.$store.commit("printTemplateModule/lock")}},{code:"top",icon:"ri-align-top",label:"置顶",status:"default",event:()=>{this.$store.commit("printTemplateModule/topComponent"),this.$store.commit("printTemplateModule/recordSnapshot")}},{code:"bottom",icon:"ri-align-bottom",label:"置底",status:"default",event:()=>{this.$store.commit("printTemplateModule/bottomComponent"),this.$store.commit("printTemplateModule/recordSnapshot")}},{code:"up",icon:"ri-arrow-up-line",label:"上移",status:"default",event:()=>{this.$store.commit("printTemplateModule/upComponent"),this.$store.commit("printTemplateModule/recordSnapshot")}},{code:"down",icon:"ri-arrow-down-line",label:"下移",status:"default",event:()=>{this.$store.commit("printTemplateModule/downComponent"),this.$store.commit("printTemplateModule/recordSnapshot")}}]:[{code:"setting",icon:"ri-list-settings-line",label:"属性",status:"default",event:()=>{this.$store.commit("printTemplateModule/setGlobalCount")}},{code:"paste",icon:"ri-clipboard-line",label:"粘贴",status:"default",event:()=>{this.$store.commit("printTemplateModule/paste",!0),this.$store.commit("printTemplateModule/recordSnapshot")}}]},scale(){return new rt.Z(this.realScale).div(new rt.Z(5)).toNumber()},shadow(){return{x:0,y:0,width:this.rectWidth,height:this.rectHeight}},canvasStyle(){return{width:5*this.rectWidth+"px",height:5*this.rectHeight+"px",transform:`scale(${this.scale})`}},isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode},panelWidth(){return this.showRight?"width: calc(100vw - 330px);":"width: calc(100vw - 95px);"}},methods:{...(0,i.nv)({reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setScale:"printTemplateModule/rulerThings/setScale"}),getShapeStyle:O,handleMouseDown(t){this.curComponent&&!_(this.curComponent.component)||t.preventDefault(),this.hideArea();const e=this.editor.getBoundingClientRect();this.editorX=e.x,this.editorY=e.y;const o=t.clientX,n=t.clientY;this.start.x=(o-this.editorX)/this.scale,this.start.y=(n-this.editorY)/this.scale,this.isShowArea=!0;const i=t=>{this.width=Math.abs((t.clientX-o)/this.scale),this.height=Math.abs((t.clientY-n)/this.scale),t.clientX<o&&(this.start.x=(t.clientX-this.editorX)/this.scale),t.clientY<n&&(this.start.y=(t.clientY-this.editorY)/this.scale)},r=t=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),t.clientX!==o||t.clientY!==n?this.createGroup():this.hideArea()};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)},handleContextMenu(t){t.stopPropagation(),t.preventDefault();let e=t.offsetY,o=t.offsetX;this.$store.commit("printTemplateModule/showContextMenu",{top:e,left:o})},hideArea(){this.isShowArea=0,this.width=0,this.height=0,this.$store.commit("printTemplateModule/setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},createGroup(){const t=this.getSelectArea();if(t.length<=1)return void this.hideArea();let e=1/0,o=1/0,n=-1/0,i=-1/0;t.forEach((t=>{let r={};"Group"===t.component?t.propValue.forEach((t=>{const s=$(`#roy-component-${t.id}`).getBoundingClientRect();r.left=s.left-this.editorX,r.top=s.top-this.editorY,r.right=s.right-this.editorX,r.bottom=s.bottom-this.editorY,r.left<o&&(o=r.left),r.top<e&&(e=r.top),r.right>n&&(n=r.right),r.bottom>i&&(i=r.bottom)})):r=H(t.style),r.left<o&&(o=r.left),r.top<e&&(e=r.top),r.right>n&&(n=r.right),r.bottom>i&&(i=r.bottom)})),this.start.x=o,this.start.y=e,this.width=n-o,this.height=i-e,this.$store.commit("printTemplateModule/setAreaData",{style:{left:o,top:e,width:this.width,height:this.height},components:t})},getSelectArea(){const t=[],{x:e,y:o}=this.start;return this.componentData.forEach((n=>{if(n.isLock)return;const{left:i,top:r,width:s,height:a}=H(n.style);e<=i&&o<=r&&i+s<=e+this.width&&r+a<=o+this.height&&t.push(n)})),t},handleLine(t){this.lines=t},handleCornerClick(){},handleScroll(){const t=document.querySelector("#screens").getBoundingClientRect(),e=document.querySelector("#designer-page").getBoundingClientRect(),o=(t.left+this.thick-e.left)/this.realScale,n=(t.top+this.thick-e.top)/this.realScale;this.startX=o,this.startY=n},handleWheel(t){if(t.ctrlKey||t.metaKey){t.preventDefault();const e=parseFloat(Math.max(.2,this.scale-t.deltaY/500).toFixed(2));e<=Lo&&e>=Ao&&this.setScale(e)}this.$nextTick((()=>{this.handleScroll()}))}},mounted(){this.rulerWidth=this.$el.offsetWidth,this.rulerHeight=this.$el.offsetHeight,this.$refs.screensRef.scrollLeft=this.$refs.containerRef.getBoundingClientRect().width/2-this.rectWidth,this.$store.commit("printTemplateModule/getEditor")},watch:{isNightMode:{handler(t){this.palette={bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:t?"#444444":"#E8E8E8",lineColor:"#4579e1",borderColor:t?"#636466":"#DADADC",cornerActiveColor:"#4579e1"},this.reDrawRuler()}},showRight:{handler(){this.$nextTick((()=>{this.rulerWidth=this.$el.offsetWidth,this.rulerHeight=this.$el.offsetHeight,this.$refs.screensRef.scrollLeft=this.$refs.containerRef.getBoundingClientRect().width/2-this.rectWidth,this.reDrawRuler()}))}},needReDrawRuler:{handler(){this.$nextTick((()=>{this.handleScroll(),this.$refs.sketchRuler?.$children[0]?.$children[0]?.drawRuler(),this.$refs.sketchRuler?.$children[1]?.$children[0]?.drawRuler()}))}}}},Io=Po,Oo=(0,c.Z)(Io,Ft,Yt,!1,null,null,null),Bo=Oo.exports,Zo={name:"DesignerMain",mixins:[Nt.Z],components:{ToolBar:Vt,Editor:Bo},props:{showRight:{type:Boolean,default:!0}},data(){return{}},computed:{...(0,i.rn)({isClickComponent:t=>t.printTemplateModule.isClickComponent})},methods:{initMounted(){},handleDrop(t){t.preventDefault(),t.stopPropagation();const e=t.dataTransfer.getData("index"),o=document.querySelector("#designer-page").getBoundingClientRect();if(e){const n=this.deepCopy(I.sy[e]);n.style=n.style||{},n.style.top=t.clientY-o.y,n.style.left=t.clientX-o.x,n.id=this.getUuid(),n.label=`${n.name}-${n.id}`,this.$store.commit("printTemplateModule/addComponent",{component:n}),this.$store.commit("printTemplateModule/recordSnapshot")}},handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("printTemplateModule/setClickComponentStatus",!1),this.$store.commit("printTemplateModule/setInEditorStatus",!0)},deselectCurComponent(){this.isClickComponent||this.$store.commit("printTemplateModule/setCurComponent",{component:null,index:null})}},created(){},mounted(){this.initMounted()},watch:{}},jo=Zo,Ho=(0,c.Z)(jo,Ot,Bt,!1,null,null,null),Wo=Ho.exports;const zo=Rt.i8;var Vo={name:"RoyPrintDesigner",components:{DesignerAside:It,DesignerMain:Wo},props:{},data(){return{defaultExpendAside:!0}},computed:{isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode}},methods:{...(0,i.nv)({initNightMode:"printTemplateModule/nightMode/initNightMode",toggleNightMode:"printTemplateModule/nightMode/toggleNightMode"}),initMounted(){console.log(`\n %c PrintTemplateDesigner® v${zo} %c ${new Date(window.printTemplateVersionTime||(new Date).getTime()).toLocaleString()}`,"color:#fff;background:linear-gradient(90deg,#4579e1,#009688);padding:5px 0;","color:#000;background:linear-gradient(90deg,#009688,#ffffff);padding:5px 10px 5px 0px;"),this.initConfig()},initConfig(){this.initNightMode()},dayNightChange(){this.toggleNightMode(!this.isNightMode)},enterFullScreen(){}},created(){},mounted(){this.initMounted()},watch:{}},Fo=Vo,Yo=(0,c.Z)(Fo,_t,kt,!1,null,"637039b3",null),Xo=Yo.exports;const Go={PtdDesigner:Xo},qo=function(t,e={}){qo.installed||(e.store?(e.store.state.printTemplateModule||e.store.registerModule(["printTemplateModule"],ct),Object.keys(Go).forEach((e=>{t.component(e,Go[e])}))):console.warn("[print-template-designer] 请提供store！"))},Uo={version:"ROY-PRINT-DESIGNER@0.0.6",install:qo};"undefined"!==typeof window&&window.Vue&&qo(window.Vue);var Jo=Uo,Ko=o(33179),Qo=o.n(Ko);n["default"].use(wt(),{size:"mini"}),n["default"].use(Qo()),n["default"].use(Jo,{store:ut}),n["default"].config.productionTip=!1,new n["default"]({router:Tt,store:ut,render:t=>t(Ct)}).$mount("#roy-app")},21917:function(t,e,o){o(57658);var n=o(70691);e["Z"]={methods:{deepCopy(t,e=[]){if(null===t||"object"!==typeof t)return t;const o=Object.prototype.toString.call(t).slice(8,-1);if("RegExp"===o)return new RegExp(t);if("Date"===o)return new Date(t);if("Error"===o)return new Error(t);const n=e.filter((e=>e.original===t))[0];if(n)return n.copy;const i=Array.isArray(t)?[]:{};return e.push({original:t,copy:i}),Object.keys(t).forEach((o=>{i[o]=this.deepCopy(t[o],e)})),i},getUuid(t=8){return(0,n.x0)(t)},isBlank(t){return void 0===t||null===t||""===t},findParentComponent(t,e){let o=t.$parent;while(o){let t=o.$options.componentName||o.$options.name;if(t===e)return o;o=o.$parent}return!1}}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}o.m=t,function(){var t=[];o.O=function(e,n,i,r){if(!n){var s=1/0;for(u=0;u<t.length;u++){n=t[u][0],i=t[u][1],r=t[u][2];for(var a=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(o.O).every((function(t){return o.O[t](n[l])}))?n.splice(l--,1):(a=!1,r<s&&(s=r));if(a){t.splice(u--,1);var c=i();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,i,r]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.f={},o.e=function(t){return Promise.all(Object.keys(o.f).reduce((function(e,n){return o.f[n](t,e),e}),[]))}}(),function(){o.u=function(t){return"js/"+t+"."+{149:"85f49a5a",158:"bf8b983d",260:"94539d9b",755:"781bbb8b",848:"5733775c"}[t]+".js"}}(),function(){o.miniCssF=function(t){return"css/"+t+"."+{149:"a272eb87",158:"f97b2fa4",260:"fce7ca8e",755:"46426441",848:"d1ff216f"}[t]+".css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="print-template-designer:";o.l=function(n,i,r,s){if(t[n])t[n].push(i);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==e+r){a=d;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",e+r),a.src=n),t[n]=[i];var h=function(e,o){a.onerror=a.onload=null,clearTimeout(p);var i=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((function(t){return t(o)})),e)return e(o)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.p="/print-template-designer/"}(),function(){var t=function(t,e,o,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=function(r){if(i.onerror=i.onload=null,"load"===r.type)o();else{var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.href||e,l=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=s,l.request=a,i.parentNode.removeChild(i),n(l)}};return i.onerror=i.onload=r,i.href=e,document.head.appendChild(i),i},e=function(t,e){for(var o=document.getElementsByTagName("link"),n=0;n<o.length;n++){var i=o[n],r=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(r===t||r===e))return i}var s=document.getElementsByTagName("style");for(n=0;n<s.length;n++){i=s[n],r=i.getAttribute("data-href");if(r===t||r===e)return i}},n=function(n){return new Promise((function(i,r){var s=o.miniCssF(n),a=o.p+s;if(e(s,a))return i();t(n,a,i,r)}))},i={143:0};o.f.miniCss=function(t,e){var o={149:1,158:1,260:1,755:1,848:1};i[t]?e.push(i[t]):0!==i[t]&&o[t]&&e.push(i[t]=n(t).then((function(){i[t]=0}),(function(e){throw delete i[t],e})))}}(),function(){var t={143:0};o.f.j=function(e,n){var i=o.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((function(o,n){i=t[e]=[o,n]}));n.push(i[2]=r);var s=o.p+o.u(e),a=new Error,l=function(n){if(o.o(t,e)&&(i=t[e],0!==i&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}};o.l(s,l,"chunk-"+e,e)}},o.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,r,s=n[0],a=n[1],l=n[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(l)var u=l(o)}for(e&&e(n);c<s.length;c++)r=s[c],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return o.O(u)},n=self["webpackChunkprint_template_designer"]=self["webpackChunkprint_template_designer"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(79230)}));n=o.O(n)})();
//# sourceMappingURL=app.a7d51784.js.map