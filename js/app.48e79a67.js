(function(){"use strict";var e={5599:function(e,t,n){var r=n(6369),i=n(3822);const o={},s={},a={},l={};var c={STORAGE_PREFIX:"_ROY_DESIGNER_",MIN_SCALE:.25,MAX_SCALE:2};const{STORAGE_PREFIX:u}=c;var d={namespaced:!0,state:()=>({isNightMode:!1}),mutations:{setIsNightMode(e,t){e.isNightMode=t.isNightMode}},actions:{toggleNightMode({commit:e},t){window.localStorage.setItem(`${u}NIGHT_MODE`,JSON.stringify(t)),document.getElementById("roy-print-template-designer").setAttribute("theme",t?"dark":"day"),e("setIsNightMode",{isNightMode:t})},async initNightMode({dispatch:e}){const t=window.localStorage.getItem(`${u}NIGHT_MODE`);null!==t&&await e("toggleNightMode",JSON.parse(t))}}},h=n(6389);const{MIN_SCALE:g,MAX_SCALE:m}=c;var p={namespaced:!0,state:()=>({scale:1,rectWidth:210,rectHeight:297,needReDrawRuler:0}),mutations:{setScale(e,t){e.scale=t.scale},setBiggerScale(e){let t=new h.Z(e.scale),n=new h.Z(.1),r=t.plus(n).toNumber();e.scale=r>m?m:r},setSmallerScale(e){let t=new h.Z(e.scale),n=new h.Z(.1),r=t.minus(n).toNumber();e.scale=r<g?g:r},setReDrawRuler(e){e.needReDrawRuler+=1},setRect(e,t){e.rectWidth=t.w,e.rectHeight=t.h},rotateRect(e){const t=e.rectHeight;e.rectHeight=Number(e.rectWidth),e.rectWidth=Number(t)}},actions:{setBiggerScale({commit:e}){e("setBiggerScale")},setSmallerScale({commit:e}){e("setSmallerScale")},setScale({commit:e},t){e("setScale",{scale:t})},reDrawRuler({commit:e}){e("setReDrawRuler")},setRect({commit:e},t){e("setRect",t)},rotateRect({commit:e}){e("rotateRect")}}},f={namespaced:!0,state:o,mutations:a,actions:l,getters:s,modules:{nightMode:d,rulerThings:p}};r["default"].use(i.ZP);var v=new i.ZP.Store({modules:{printTemplateModule:f}}),_=function(){var e=this,t=e._self._c;return t("PtdDesigner")},w=[],C={name:"App"},y=C,b=n(1001),M=(0,b.Z)(y,_,w,!1,null,null,null),R=M.exports,S=n(8499),T=n.n(S),k=n(2631);r["default"].use(k.ZP);const A=[],D=new k.ZP({mode:"history",base:"/",routes:A});var N=D,E=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"roy-designer-container",attrs:{id:"roy-print-template-designer",theme:"day"}},[t("el-header",{staticClass:"roy-designer-header",attrs:{height:"40px"}},[t("div",{staticClass:"roy-designer-header__text"},[t("i",{staticClass:"ri-pen-nib-line"}),t("span",[e._v("打印模板设计器")])]),t("div",{staticClass:"roy-night-mode"},[t("transition-group",{attrs:{name:"roy-fade",tag:"span"}},[e.isNightMode?t("i",{key:1,staticClass:"ri-haze-fill",on:{click:e.dayNightChange}}):t("i",{key:2,staticClass:"ri-moon-foggy-fill",on:{click:e.dayNightChange}})])],1)]),t("el-container",{staticStyle:{height:"calc(100% - 40px)"}},[t("el-aside",{staticClass:"roy-designer-aside",attrs:{width:"auto"}},[t("DesignerAside")],1),t("el-main",{staticClass:"roy-designer-main"},[t("DesignerMain")],1)],1)],1)},x=[],P={i8:"0.0.6"},L=function(){var e=this,t=e._self._c;return t("section",{staticClass:"roy-designer-aside__main",style:e.asideStyle},[t("el-menu",{staticClass:"roy-designer-aside__menu",attrs:{collapse:!0,"default-active":"0"},on:{select:e.onMenuSelect}},e._l(e.menuList,(function(n,r){return t("el-menu-item",{key:n.code,attrs:{index:`${r}`}},[t("div",{staticClass:"roy-designer-aside__menu__icon"},[t("i",{class:n.icon}),t("span",[e._v(e._s(n.name))])])])})),1),t("keep-alive",[t(e.curActiveComponent,{directives:[{name:"show",rawName:"v-show",value:e.showRight,expression:"showRight"}],key:e.curActiveComponentCode,tag:"component",staticClass:"roy-designer-aside__right_panel"})],1)],1)},B=[],O=n(1917),$={name:"DesignerAside",mixins:[O.Z],data(){return{showRight:!0,menuList:[{name:"组件",code:"component",icon:"ri-pencil-ruler-2-line",component:()=>n.e(945).then(n.bind(n,4945))},{name:"区块",code:"blocks",icon:"ri-layout-5-line",component:()=>n.e(565).then(n.bind(n,3565))},{name:"页面",code:"page",icon:"ri-stack-line",component:()=>n.e(377).then(n.bind(n,4377))},{name:"大纲",code:"toc",icon:"ri-pages-line",component:()=>n.e(502).then(n.bind(n,7502))},{name:"工具",code:"tools",icon:"ri-magic-line",component:()=>n.e(746).then(n.bind(n,2746))},{name:"全局",code:"setting",icon:"ri-sound-module-line",component:()=>n.e(205).then(n.bind(n,6205))}],curActiveComponent:null,curActiveComponentCode:""}},computed:{asideStyle(){return this.showRight?"width: 300px":"width: 65px"}},methods:{onMenuSelect(e){this.curActiveComponentCode===this.menuList[e].code?this.showRight=!this.showRight:this.showRight=!0,this.curActiveComponent=this.menuList[e].component,this.curActiveComponentCode=this.menuList[e].code}},mounted(){this.curActiveComponent=this.menuList[0].component,this.curActiveComponentCode=this.menuList[0].code}},Z=$,j=(0,b.Z)(Z,L,B,!1,null,"88bbf378",null),H=j.exports,W=function(){var e=this,t=e._self._c;return t("section",{staticClass:"height-all"},[t("ToolBar"),t("Editor")],1)},I=[],F=function(){var e=this,t=e._self._c;return t("el-header",{staticClass:"roy-designer-main__toolbar",attrs:{height:"45px"}},[t("section",{staticClass:"roy-designer-main__toolbar_left"},e._l(e.toolbarLeftConfig,(function(e,n){return t("el-tooltip",{key:n,attrs:{content:e.name,"open-delay":600,"visible-arrow":!1,effect:"dark",placement:"bottom"}},[t("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:e.event}},[t("i",{class:e.icon})])])})),1),t("section",[t("strong",[e._v("这是模板名称位置")])]),t("section",{staticClass:"roy-designer-main__toolbar_right"},[t("div",{staticClass:"roy-designer-main__toolbar__zoom"},[t("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.smallerScale.apply(null,arguments)}}},[t("i",{staticClass:"ri-zoom-out-line"})]),t("span",[e._v(e._s(e.scale100)+"%")]),t("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.biggerScale.apply(null,arguments)}}},[t("i",{staticClass:"ri-zoom-in-line"})])]),t("div",{staticClass:"roy-designer-main__toolbar__setting"},[t("span",[e._v(e._s(e.rectWidth)+"/"+e._s(e.rectHeight))]),t("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:e.showPagerConfig}},[t("i",{staticClass:"ri-settings-2-line"})]),t("div",{staticClass:"roy-designer-main__toolbar__item",on:{click:e.rotatePage}},[t("i",{staticClass:"ri-clockwise-line"})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showPager,expression:"showPager"}],staticClass:"roy-designer-main__toolbar__pages"},[t("el-row",[t("el-col",{attrs:{span:6}},[e._v("纸张大小:")]),t("el-col",{attrs:{span:18}},[t("div",{staticClass:"roy-designer-main__toolbar__pages__container"},e._l(Object.values(e.pages),(function(n){return t("div",{key:n.name,staticClass:"roy-designer-main__toolbar__pages__item",class:e.currentPage===n.name?"roy-designer-main__toolbar__pages__item--active":"",on:{click:function(t){e.currentPage=n.name}}},[e._v(" "+e._s(n.name)+" ")])})),0)])],1)],1)])])])},X=[],Y={name:"ToolBar",mixins:[O.Z],components:{},props:{},data(){return{showPager:!1,toolbarLeftConfig:[{name:"撤销",icon:"ri-arrow-go-back-fill",event:()=>{alert("撤销")}},{name:"恢复",icon:"ri-arrow-go-forward-fill",event:()=>{}},{name:"预览",icon:"ri-eye-2-fill",event:()=>{}},{name:"保存",icon:"ri-save-2-fill",event:()=>{}},{name:"锁定",icon:"ri-lock-2-line",event:()=>{}},{name:"组合/拆分",icon:"ri-collage-line",event:()=>{}}],pages:{A3:{name:"A3",w:297,h:420},A4:{name:"A4",w:210,h:297},B5:{name:"B5",w:176,h:250}},currentPage:"A4"}},computed:{...(0,i.rn)({scale:e=>e.printTemplateModule.rulerThings.scale,rectWidth:e=>e.printTemplateModule.rulerThings.rectWidth,rectHeight:e=>e.printTemplateModule.rulerThings.rectHeight}),scale100(){let e=new h.Z(this.scale),t=new h.Z(100);return e.mul(t).toNumber()}},methods:{...(0,i.nv)({setBiggerScale:"printTemplateModule/rulerThings/setBiggerScale",setSmallerScale:"printTemplateModule/rulerThings/setSmallerScale",reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setRect:"printTemplateModule/rulerThings/setRect",rotateRect:"printTemplateModule/rulerThings/rotateRect"}),smallerScale(){this.setSmallerScale(),this.reDrawRuler()},biggerScale(){this.setBiggerScale(),this.reDrawRuler()},showPagerConfig(){this.showPager=!this.showPager},rotatePage(){this.rotateRect(),this.reDrawRuler()},initMounted(){}},created(){},mounted(){this.initMounted()},watch:{currentPage(e){let t=this.pages[e];this.setRect(t),this.reDrawRuler()}}},z=Y,G=(0,b.Z)(z,F,X,!1,null,"7d5a73a4",null),q=G.exports,K=function(){var e=this,t=e._self._c;return t("div",{staticClass:"roy-designer-main__page"},[t("SketchRuler",{ref:"sketchRuler",attrs:{lang:e.lang,thick:e.thick,scale:e.scale,width:e.rulerWidth,height:e.rulerHeight,startX:e.startX,startY:e.startY,shadow:e.shadow,horLineArr:e.lines.h,verLineArr:e.lines.v,cornerActive:!1,palette:e.palette},on:{handleLine:e.handleLine,onCornerClick:e.handleCornerClick}}),t("div",{ref:"screensRef",attrs:{id:"screens"},on:{wheel:e.handleWheel,scroll:e.handleScroll}},[t("div",{ref:"containerRef",staticClass:"screen-container"},[t("div",{style:e.canvasStyle,attrs:{id:"designer-page"}},[t("div",[e._v("测试页面")])])])])],1)},J=[],U=n(942);const{MIN_SCALE:V,MAX_SCALE:Q}=c;var ee={name:"RoyEditor",data(){return{rulerWidth:0,rulerHeight:0,startX:-19,startY:-19,lines:{h:[],v:[]},thick:20,lang:"zh-CN",isShowRuler:!0,isShowReferLine:!0,palette:{bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#4579e1",borderColor:"#DADADC",cornerActiveColor:"#4579e1"}}},components:{SketchRuler:U.Z},computed:{...(0,i.rn)({scale:e=>e.printTemplateModule.rulerThings.scale,rectWidth:e=>e.printTemplateModule.rulerThings.rectWidth,rectHeight:e=>e.printTemplateModule.rulerThings.rectHeight,needReDrawRuler:e=>e.printTemplateModule.rulerThings.needReDrawRuler}),shadow(){return{x:0,y:0,width:5*this.rectWidth,height:5*this.rectHeight}},canvasStyle(){return{width:5*this.rectWidth+"px",height:5*this.rectHeight+"px",transform:`scale(${this.scale})`}},isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode}},methods:{...(0,i.nv)({reDrawRuler:"printTemplateModule/rulerThings/reDrawRuler",setScale:"printTemplateModule/rulerThings/setScale"}),handleLine(e){this.lines=e},handleCornerClick(){},handleScroll(){const e=document.querySelector("#screens").getBoundingClientRect(),t=document.querySelector("#designer-page").getBoundingClientRect(),n=(e.left+this.thick-t.left)/this.scale,r=(e.top+this.thick-t.top)/this.scale;this.startX=n,this.startY=r},handleWheel(e){if(e.ctrlKey||e.metaKey){e.preventDefault();const t=parseFloat(Math.max(.2,this.scale-e.deltaY/500).toFixed(2));t<=Q&&t>=V&&this.setScale(t)}this.$nextTick((()=>{this.handleScroll()}))}},mounted(){this.rulerWidth=this.$el.offsetWidth,this.rulerHeight=this.$el.offsetHeight,this.$refs.screensRef.scrollLeft=this.$refs.containerRef.getBoundingClientRect().width/2-300},watch:{isNightMode:{handler(e){this.palette={bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:e?"#444444":"#E8E8E8",lineColor:"#4579e1",borderColor:e?"#636466":"#DADADC",cornerActiveColor:"#4579e1"},this.reDrawRuler()}},needReDrawRuler:{handler(){this.$nextTick((()=>{this.handleScroll(),this.$refs.sketchRuler?.$children[0]?.$children[0]?.drawRuler(),this.$refs.sketchRuler?.$children[1]?.$children[0]?.drawRuler()}))}}}},te=ee,ne=(0,b.Z)(te,K,J,!1,null,null,null),re=ne.exports,ie={name:"DesignerMain",mixins:[O.Z],components:{ToolBar:q,Editor:re},props:{},data(){return{}},methods:{initMounted(){}},created(){},mounted(){this.initMounted()},watch:{}},oe=ie,se=(0,b.Z)(oe,W,I,!1,null,null,null),ae=se.exports;const le=P.i8;var ce={name:"RoyPrintDesigner",components:{DesignerAside:H,DesignerMain:ae},props:{},data(){return{}},computed:{isNightMode(){return this.$store.state.printTemplateModule.nightMode.isNightMode}},methods:{...(0,i.nv)({initNightMode:"printTemplateModule/nightMode/initNightMode",toggleNightMode:"printTemplateModule/nightMode/toggleNightMode"}),initMounted(){console.log(`\n %c PrintTemplateDesigner® v${le} %c ${new Date(window.versionTime||(new Date).getTime()).toLocaleString()}`,"color:#fff;background:linear-gradient(90deg,#4579e1,#009688);padding:5px 0;","color:#000;background:linear-gradient(90deg,#009688,#ffffff);padding:5px 10px 5px 0px;"),this.initConfig()},initConfig(){this.initNightMode()},dayNightChange(){this.toggleNightMode(!this.isNightMode)},enterFullScreen(){}},created(){},mounted(){this.initMounted()},watch:{}},ue=ce,de=(0,b.Z)(ue,E,x,!1,null,"2ff49100",null),he=de.exports;const ge={PtdDesigner:he},me=function(e,t={}){me.installed||(t.store?(t.store.state.printTemplateModule||t.store.registerModule(["printTemplateModule"],f),Object.keys(ge).forEach((t=>{e.component(t,ge[t])}))):console.warn("[print-template-designer] 请提供store！"))},pe={version:"ROY-PRINT-DESIGNER@0.0.6",install:me};"undefined"!==typeof window&&window.Vue&&me(window.Vue);var fe=pe;r["default"].use(T(),{size:"small"}),r["default"].use(fe,{store:v}),r["default"].config.productionTip=!1,new r["default"]({router:N,store:v,render:e=>e(R)}).$mount("#roy-app")},1917:function(e,t,n){n(7658);t["Z"]={methods:{deepCopy(e,t=[]){if(null===e||"object"!==typeof e)return e;const n=Object.prototype.toString.call(e).slice(8,-1);if("RegExp"===n)return new RegExp(e);if("Date"===n)return new Date(e);if("Error"===n)return new Error(e);const r=t.filter((t=>t.original===e))[0];if(r)return r.copy;const i=Array.isArray(e)?[]:{};return t.push({original:e,copy:i}),Object.keys(e).forEach((n=>{i[n]=this.deepCopy(e[n],t)})),i},getUuid(e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let t=[];for(let r=0;r<36;r++)t[r]=e.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="";let n=t.join("");return n},isBlank(e){return void 0===e||null===e||""===e},findParentComponent(e,t){let n=e.$parent;while(n){let e=n.$options.componentName||n.$options.name;if(e===t)return n;n=n.$parent}return!1}}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,r,i,o){if(!r){var s=1/0;for(u=0;u<e.length;u++){r=e[u][0],i=e[u][1],o=e[u][2];for(var a=!0,l=0;l<r.length;l++)(!1&o||s>=o)&&Object.keys(n.O).every((function(e){return n.O[e](r[l])}))?r.splice(l--,1):(a=!1,o<s&&(s=o));if(a){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,i,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/"+e+"."+{205:"07c66e71",377:"83e43016",502:"549d4716",565:"d656503b",746:"543f3a2c",945:"12716093"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/"+e+"."+{205:"a078fa9c",377:"8a5be450",502:"c37e4a67",565:"d6635a5f",746:"581fe9f6",945:"3ad803b4"}[e]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="print-template-designer:";n.l=function(r,i,o,s){if(e[r])e[r].push(i);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){a=d;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var h=function(t,n){a.onerror=a.onload=null,clearTimeout(g);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((function(e){return e(n)})),t)return t(n)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/print-template-designer/"}(),function(){var e=function(e,t,n,r){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var o=function(o){if(i.onerror=i.onload=null,"load"===o.type)n();else{var s=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=s,l.request=a,i.parentNode.removeChild(i),r(l)}};return i.onerror=i.onload=o,i.href=t,document.head.appendChild(i),i},t=function(e,t){for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var i=n[r],o=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(o===e||o===t))return i}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){i=s[r],o=i.getAttribute("data-href");if(o===e||o===t)return i}},r=function(r){return new Promise((function(i,o){var s=n.miniCssF(r),a=n.p+s;if(t(s,a))return i();e(r,a,i,o)}))},i={143:0};n.f.miniCss=function(e,t){var n={205:1,377:1,502:1,565:1,746:1,945:1};i[e]?t.push(i[e]):0!==i[e]&&n[e]&&t.push(i[e]=r(e).then((function(){i[e]=0}),(function(t){throw delete i[e],t})))}}(),function(){var e={143:0};n.f.j=function(t,r){var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise((function(n,r){i=e[t]=[n,r]}));r.push(i[2]=o);var s=n.p+n.u(t),a=new Error,l=function(r){if(n.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}};n.l(s,l,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,o,s=r[0],a=r[1],l=r[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var u=l(n)}for(t&&t(r);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},r=self["webpackChunkprint_template_designer"]=self["webpackChunkprint_template_designer"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(5599)}));r=n.O(r)})();
//# sourceMappingURL=app.48e79a67.js.map